<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<link href="toc.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="toc.html">Table of contents</a>
      <a href="https://github.com/AU-COBRA/ConCert" target="_balnk">Project Page</a>
    </span>
</div>
  <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="js-toc-header" class="toc-header">Contents:</div>
    <div id="js-toc" class="toc" data-toc="h1,h2,h3,h4" data-toc-container="doc">
    </div>
    <div id="main">
<h1 class="libtitle">Library ConCert.Execution.Examples.EIP20Token</h1>

<div class="code">
</div>

<div class="doc">
<a name="lab108"></a><h1 class="section">EIP20 Token Implementation</h1>

<div class="paragraph"> </div>

  This file contains an implementation of the EIP 20 Token Specification (https://eips.ethereum.org/EIPS/eip-20).

<div class="paragraph"> </div>

  The implementation is essentially a port of
  https://github.com/ConsenSys/Tokens/blob/fdf687c69d998266a95f15216b1955a4965a0a6d/contracts/eip20/EIP20.sol

</div>
<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.ZArith.html#"><span class="id" title="library">ZArith</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.micromega.Lia.html#"><span class="id" title="library">Lia</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Sorting.Permutation.html#"><span class="id" title="library">Permutation</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Containers.html#"><span class="id" title="library">Containers</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Monads.html#"><span class="id" title="library">Monads</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Extras.html#"><span class="id" title="library">Extras</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Serializable.html#"><span class="id" title="library">Serializable</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Blockchain.html#"><span class="id" title="library">Blockchain</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution.Examples</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Examples.Common.html#"><span class="id" title="library">Common</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Utils.Automation.html#"><span class="id" title="library">Automation</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Utils.RecordUpdate.html#"><span class="id" title="library">RecordUpdate</span></a>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">RecordSetNotations</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab109"></a><h1 class="section">Contract types</h1>

</div>
<div class="code">
<span class="id" title="keyword">Section</span> <a name="EIP20Token"><span class="id" title="section">EIP20Token</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">BaseTypes</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainBase"><span class="id" title="class">ChainBase</span></a>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Set</span> <span class="id" title="var">Nonrecursive</span> <span class="id" title="var">Elimination</span> <span class="id" title="var">Schemes</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="TokenValue"><span class="id" title="definition">TokenValue</span></a> := <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Numbers.BinNums.html#N"><span class="id" title="inductive">N</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">N_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">bool</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <a name="Msg"><span class="id" title="inductive">Msg</span></a> :=<br/>
&nbsp;&nbsp;| <a name="transfer"><span class="id" title="constructor">transfer</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#Msg"><span class="id" title="inductive">Msg</span></a><br/>
&nbsp;&nbsp;| <a name="transfer_from"><span class="id" title="constructor">transfer_from</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#Msg"><span class="id" title="inductive">Msg</span></a><br/>
&nbsp;&nbsp;| <a name="approve"><span class="id" title="constructor">approve</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#Msg"><span class="id" title="inductive">Msg</span></a>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a name="State"><span class="id" title="record">State</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a name="build_state"><span class="id" title="constructor">build_state</span></a> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name="total_supply"><span class="id" title="projection">total_supply</span></a> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name="balances"><span class="id" title="projection">balances</span></a> : <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.AddrMap"><span class="id" title="abbreviation">AddressMap.AddrMap</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name="allowances"><span class="id" title="projection">allowances</span></a> : <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.AddrMap"><span class="id" title="abbreviation">AddressMap.AddrMap</span></a> (<a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.AddrMap"><span class="id" title="abbreviation">AddressMap.AddrMap</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Record</span> <a name="Setup"><span class="id" title="record">Setup</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a name="build_setup"><span class="id" title="constructor">build_setup</span></a> {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name="owner"><span class="id" title="projection">owner</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a name="init_amount"><span class="id" title="projection">init_amount</span></a> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}.<br/>

<br/>

<br/>
</div>

<div class="doc">
<a name="lab110"></a><h1 class="section">Contract functions</h1>
<a name="lab111"></a><h2 class="section">init</h2>
 Initialize contract storage 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="init"><span class="id" title="definition">init</span></a> (<span class="id" title="var">chain</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ctx</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">setup</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#Setup"><span class="id" title="record">Setup</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">State</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> {| <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">setup</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">.(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">init_amount</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">);</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">AddressMap.add</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">setup</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">.(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">owner</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">)</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">setup</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">.(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">init_amount</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">)</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">AddressMap.empty</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">AddressMap.empty</span></a> |}.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="increment_balance"><span class="id" title="definition">increment_balance</span></a> (<span class="id" title="var">m</span> : <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.AddrMap"><span class="id" title="abbreviation">AddressMap.AddrMap</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a>) (<span class="id" title="var">addr</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>) (<span class="id" title="var">inc</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a>) : <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.AddrMap"><span class="id" title="abbreviation">AddressMap.AddrMap</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.find"><span class="id" title="definition">AddressMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#addr"><span class="id" title="variable">addr</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#m"><span class="id" title="variable">m</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">old</span> =&gt; <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.add"><span class="id" title="definition">AddressMap.add</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#addr"><span class="id" title="variable">addr</span></a> (<span class="id" title="var">old</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#inc"><span class="id" title="variable">inc</span></a>) <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#m"><span class="id" title="variable">m</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.add"><span class="id" title="definition">AddressMap.add</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#addr"><span class="id" title="variable">addr</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#inc"><span class="id" title="variable">inc</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#m"><span class="id" title="variable">m</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab112"></a><h2 class="section">transfer</h2>
 Transfers <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.FA2Interface.html#amount"><span class="id" title="projection">amount</span></a></span> tokens, if <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#from"><span class="id" title="projection">from</span></a></span> has enough tokens to transfer 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="try_transfer"><span class="id" title="definition">try_transfer</span></a> (<span class="id" title="var">from</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">to</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">amount</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">state</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">State</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">State</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">from_balance</span> := <a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.find"><span class="id" title="definition">AddressMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a>)) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from_balance"><span class="id" title="variable">from_balance</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#b39870dee55afcd85c6b795fb34de165"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">let</span> <span class="id" title="var">new_balances</span> := <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.add"><span class="id" title="definition">AddressMap.add</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from_balance"><span class="id" title="variable">from_balance</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">-</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>) <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_balances</span> := <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#increment_balance"><span class="id" title="definition">increment_balance</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_balances"><span class="id" title="variable">new_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_balances"><span class="id" title="variable">new_balances</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab113"></a><h2 class="section">transfer_from</h2>
 The delegate tries to transfer <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.FA2Interface.html#amount"><span class="id" title="projection">amount</span></a></span> tokens from <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#from"><span class="id" title="projection">from</span></a></span> to <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#to"><span class="id" title="projection">to</span></a></span>.
      Succeeds if <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#from"><span class="id" title="projection">from</span></a></span> has indeed allowed the delegate to spend at least <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.FA2Interface.html#amount"><span class="id" title="projection">amount</span></a></span> tokens on its behalf. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="try_transfer_from"><span class="id" title="definition">try_transfer_from</span></a> (<span class="id" title="var">delegate</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">from</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">to</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">amount</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">state</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">State</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">State</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">from_allowances_map</span> <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.find"><span class="id" title="definition">AddressMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#allowances"><span class="id" title="projection">allowances</span></a>) <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">delegate_allowance</span> <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.find"><span class="id" title="definition">AddressMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from_allowances_map"><span class="id" title="variable">from_allowances_map</span></a> <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">from_balance</span> := <a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.find"><span class="id" title="definition">AddressMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a>)) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate_allowance"><span class="id" title="variable">delegate_allowance</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#b39870dee55afcd85c6b795fb34de165"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from_balance"><span class="id" title="variable">from_balance</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#b39870dee55afcd85c6b795fb34de165"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">let</span> <span class="id" title="var">new_allowances</span> := <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.add"><span class="id" title="definition">AddressMap.add</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate_allowance"><span class="id" title="variable">delegate_allowance</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">-</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>) <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from_allowances_map"><span class="id" title="variable">from_allowances_map</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_balances</span> := <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.add"><span class="id" title="definition">AddressMap.add</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from_balance"><span class="id" title="variable">from_balance</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">-</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>) <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_balances</span> := <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#increment_balance"><span class="id" title="definition">increment_balance</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_balances"><span class="id" title="variable">new_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_balances"><span class="id" title="variable">new_balances</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#allowances"><span class="id" title="projection">allowances</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">::=</span></a> <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.add"><span class="id" title="definition">AddressMap.add</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_allowances"><span class="id" title="variable">new_allowances</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">|&gt;</span></a>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab114"></a><h2 class="section">approve</h2>
 The caller approves the delegate to transfer up to <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.FA2Interface.html#amount"><span class="id" title="projection">amount</span></a></span> tokens on behalf of the caller 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="try_approve"><span class="id" title="definition">try_approve</span></a> (<span class="id" title="var">caller</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">delegate</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">amount</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">state</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">State</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">State</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.find"><span class="id" title="definition">AddressMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#caller"><span class="id" title="variable">caller</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#allowances"><span class="id" title="projection">allowances</span></a>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">caller_allowances</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#allowances"><span class="id" title="projection">allowances</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">::=</span></a> <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.add"><span class="id" title="definition">AddressMap.add</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#caller"><span class="id" title="variable">caller</span></a> (<a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.add"><span class="id" title="definition">AddressMap.add</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a> <span class="id" title="var">caller_allowances</span>) <a class="idref" href="ConCert.Utils.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">|&gt;</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#allowances"><span class="id" title="projection">allowances</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">::=</span></a> <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.add"><span class="id" title="definition">AddressMap.add</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#caller"><span class="id" title="variable">caller</span></a> (<a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.add"><span class="id" title="definition">AddressMap.add</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="ConCert.Execution.Examples.Common.html#AddressMap.empty"><span class="id" title="definition">AddressMap.empty</span></a>) <a class="idref" href="ConCert.Utils.RecordSet.html#394068d0cf93ac4dd96dfc7ba41b06b2"><span class="id" title="notation">|&gt;</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab115"></a><h2 class="section">receive</h2>
 Contract entrypoint function 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="receive"><span class="id" title="definition">receive</span></a> (<span class="id" title="var">chain</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ctx</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">state</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">maybe_msg</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#Msg"><span class="id" title="inductive">Msg</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">State</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">*</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#ActionBody"><span class="id" title="inductive">ActionBody</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">sender</span> := <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">without_actions</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option_map"><span class="id" title="definition">option_map</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">new_state</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
Only allow calls with no money attached 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#0f6d3b46a03d1336a5ac68936077dc02"><span class="id" title="notation">&gt;?</span></a> 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">match</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#maybe_msg"><span class="id" title="variable">maybe_msg</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer"><span class="id" title="constructor">transfer</span></a> <span class="id" title="var">to</span> <span class="id" title="var">amount</span>) =&gt; <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#without_actions"><span class="id" title="variable">without_actions</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer"><span class="id" title="definition">try_transfer</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sender"><span class="id" title="variable">sender</span></a> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a>)<br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer_from"><span class="id" title="constructor">transfer_from</span></a> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span>) =&gt; <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#without_actions"><span class="id" title="variable">without_actions</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from"><span class="id" title="definition">try_transfer_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sender"><span class="id" title="variable">sender</span></a> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a>)<br/>
&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#approve"><span class="id" title="constructor">approve</span></a> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span>) =&gt; <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#without_actions"><span class="id" title="variable">without_actions</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_approve"><span class="id" title="definition">try_approve</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sender"><span class="id" title="variable">sender</span></a> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a>)<br/>
&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
transfer actions to this contract are not allowed 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <a name="contract"><span class="id" title="definition">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Contract"><span class="id" title="record">Contract</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#Setup"><span class="id" title="record">Setup</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#Msg"><span class="id" title="inductive">Msg</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">State</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#build_contract"><span class="id" title="constructor">build_contract</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#init"><span class="id" title="definition">init</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab116"></a><h1 class="section">Properties</h1>

</div>
<div class="code">
<span class="id" title="keyword">Section</span> <a name="EIP20Token.Theories"><span class="id" title="section">Theories</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab117"></a><h2 class="section">EIP20 functions not payable</h2>

<div class="paragraph"> </div>

 <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.BAT_AltFix.html#receive"><span class="id" title="definition">receive</span></a></span> only returns Some if the sender amount is zero 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="EIP20_not_payable"><span class="id" title="lemma">EIP20_not_payable</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">msg</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#msg"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#306329b0eca7a2b86c198702f594ad8e"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#306329b0eca7a2b86c198702f594ad8e"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#306329b0eca7a2b86c198702f594ad8e"><span class="id" title="notation">&lt;=</span></a> 0)%<span class="id" title="var">Z</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">amount</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;case:&nbsp;ctx_amount&nbsp;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;case:&nbsp;ctx_amount&nbsp;&lt;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.gtb_ltb"><span class="id" title="lemma">Z.gtb_ltb</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.ltb_ge"><span class="id" title="lemma">Z.ltb_ge</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">amount</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Lemma for simplifying the <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.BAT_AltFix.html#receive"><span class="id" title="definition">receive</span></a></span> function by eliminating the case
    where sender amount is larger than zero 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="receive_not_payable"><span class="id" title="lemma">receive_not_payable</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">msg</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#msg"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#msg"><span class="id" title="variable">msg</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer"><span class="id" title="constructor">transfer</span></a> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option_map"><span class="id" title="definition">option_map</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">new_state</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">State</span></a> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer"><span class="id" title="definition">try_transfer</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a>) <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer_from"><span class="id" title="constructor">transfer_from</span></a> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option_map"><span class="id" title="definition">option_map</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">new_state</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">State</span></a> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from"><span class="id" title="definition">try_transfer_from</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a>) <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#approve"><span class="id" title="constructor">approve</span></a> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option_map"><span class="id" title="definition">option_map</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">new_state</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">State</span></a> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_approve"><span class="id" title="definition">try_approve</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a>) <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#EIP20_not_payable"><span class="id" title="lemma">EIP20_not_payable</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> <span class="id" title="var">amount_zero</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.ltb_ge"><span class="id" title="lemma">Z.ltb_ge</span></a>, &lt;- <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.gtb_ltb"><span class="id" title="lemma">Z.gtb_ltb</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">amount_zero</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">amount_zero</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab118"></a><h2 class="section">EIP20 functions produce no acts</h2>

<div class="paragraph"> </div>

 <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.BAT_AltFix.html#receive"><span class="id" title="definition">receive</span></a></span> never produces any <span class="inlinecode"><a class="idref" href="ConCert.Embedding.Examples.ExecFrameworkIntegration.html#new_acts"><span class="id" title="variable">new_acts</span></a></span> 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="EIP20_no_acts"><span class="id" title="lemma">EIP20_no_acts</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">msg</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#msg"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option_map"><span class="id" title="definition">option_map</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">destruct_match</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="receive_no_acts"><span class="id" title="lemma">receive_no_acts</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">msg</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#msg"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#msg"><span class="id" title="variable">msg</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> &lt;- <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#EIP20_no_acts"><span class="id" title="lemma">EIP20_no_acts</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Default entrypoint always fail 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="default_none"><span class="id" title="lemma">default_none</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">destruct_match</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>

<br/>
</div>

<div class="doc">
<a name="lab119"></a><h2 class="section">Expected behvaiour of EIP20 functions</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a name="transfer_balance_update_correct"><span class="id" title="definition">transfer_balance_update_correct</span></a> <span class="id" title="var">old_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">tokens</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">get_balance</span> <span class="id" title="var">addr</span> <span class="id" title="var">state</span> := <a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#addr"><span class="id" title="variable">addr</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a>)) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">from_balance_before</span> := <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_balance"><span class="id" title="variable">get_balance</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#old_state"><span class="id" title="variable">old_state</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">to_balance_before</span> := <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_balance"><span class="id" title="variable">get_balance</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#old_state"><span class="id" title="variable">old_state</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">from_balance_after</span> := <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_balance"><span class="id" title="variable">get_balance</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">to_balance_after</span> := <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_balance"><span class="id" title="variable">get_balance</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;</div>

<div class="doc">
if the transfer is a self-transfer, balances should remain unchained 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">if</span> <a class="idref" href="ConCert.Execution.Blockchain.html#address_eqb"><span class="id" title="method">address_eqb</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from_balance_before"><span class="id" title="variable">from_balance_before</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#59a5ff4a6cbb127625aba1a377a243d1"><span class="id" title="notation">=?</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from_balance_after"><span class="id" title="variable">from_balance_after</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">&amp;&amp;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to_balance_before"><span class="id" title="variable">to_balance_before</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#59a5ff4a6cbb127625aba1a377a243d1"><span class="id" title="notation">=?</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to_balance_after"><span class="id" title="variable">to_balance_after</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from_balance_before"><span class="id" title="variable">from_balance_before</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#59a5ff4a6cbb127625aba1a377a243d1"><span class="id" title="notation">=?</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from_balance_after"><span class="id" title="variable">from_balance_after</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#tokens"><span class="id" title="variable">tokens</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">&amp;&amp;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to_balance_before"><span class="id" title="variable">to_balance_before</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#tokens"><span class="id" title="variable">tokens</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#59a5ff4a6cbb127625aba1a377a243d1"><span class="id" title="notation">=?</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to_balance_after"><span class="id" title="variable">to_balance_after</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">)</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="get_allowance"><span class="id" title="definition">get_allowance</span></a> <span class="id" title="var">state</span> <span class="id" title="var">from</span> <span class="id" title="var">delegate</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> (<a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> (@<a class="idref" href="ConCert.Execution.Containers.html#FMap.empty"><span class="id" title="abbreviation">FMap.empty</span></a> (<a class="idref" href="ConCert.Execution.Containers.html#FMap"><span class="id" title="abbreviation">FMap</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a>) <span class="id" title="var">_</span>) (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#allowances"><span class="id" title="projection">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a>)))).<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="transfer_from_allowances_update_correct"><span class="id" title="definition">transfer_from_allowances_update_correct</span></a> (<span class="id" title="var">old_state</span> <span class="id" title="var">new_state</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">State</span></a>) (<span class="id" title="var">from</span> <span class="id" title="var">delegate</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>) (<span class="id" title="var">tokens</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">delegate_allowance_before</span> := <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_allowance"><span class="id" title="definition">get_allowance</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#old_state"><span class="id" title="variable">old_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">delegate_allowance_after</span> := <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_allowance"><span class="id" title="definition">get_allowance</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> <span class="id" title="tactic">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate_allowance_before"><span class="id" title="variable">delegate_allowance_before</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#59a5ff4a6cbb127625aba1a377a243d1"><span class="id" title="notation">=?</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate_allowance_after"><span class="id" title="variable">delegate_allowance_after</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#tokens"><span class="id" title="variable">tokens</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="approve_allowance_update_correct"><span class="id" title="definition">approve_allowance_update_correct</span></a> (<span class="id" title="var">new_state</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">State</span></a>) (<span class="id" title="var">from</span> <span class="id" title="var">delegate</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>) (<span class="id" title="var">tokens</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">delegate_allowance_after</span> := <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_allowance"><span class="id" title="definition">get_allowance</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate_allowance_after"><span class="id" title="variable">delegate_allowance_after</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#59a5ff4a6cbb127625aba1a377a243d1"><span class="id" title="notation">=?</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#tokens"><span class="id" title="variable">tokens</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab120"></a><h2 class="section">Transfer correct</h2>

<div class="paragraph"> </div>

 <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#Dexter2Lqt.try_transfer"><span class="id" title="definition">try_transfer</span></a></span> correctly moves <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.FA2Interface.html#amount"><span class="id" title="projection">amount</span></a></span> from <span class="inlinecode"><a class="idref" href="ConCert.Embedding.Examples.crowdfunding.CrowdfundingData.html#sender"><span class="id" title="definition">sender</span></a></span> to <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#to"><span class="id" title="projection">to</span></a></span> 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_balance_correct"><span class="id" title="lemma">try_transfer_balance_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer"><span class="id" title="constructor">transfer</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer_balance_update_correct"><span class="id" title="definition">transfer_balance_update_correct</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer_balance_update_correct"><span class="id" title="definition">transfer_balance_update_correct</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">H</span> <span class="id" title="var">into</span> <span class="id" title="var">sender_enough_balance</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.ltb_ge"><span class="id" title="lemma">N.ltb_ge</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">sender_enough_balance</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <span class="id" title="var">ctx</span>) (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a> <span class="id" title="var">prev_state</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">from_prev</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">from_prev</span> || <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">from_prev</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">from_prev</span> <span class="id" title="var">new_acts</span> <span class="id" title="var">chain</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;case:&nbsp;from&nbsp;=&nbsp;&nbsp;to&nbsp;&amp;&amp;&nbsp;find&nbsp;from&nbsp;=&nbsp;Some&nbsp;n&nbsp;&amp;&amp;&nbsp;amount&nbsp;&lt;=&nbsp;n&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.sub_add"><span class="id" title="lemma">N.sub_add</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.eqb_refl"><span class="id" title="lemma">N.eqb_refl</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;case:&nbsp;from&nbsp;=&nbsp;&nbsp;to&nbsp;&amp;&amp;&nbsp;find&nbsp;from&nbsp;=&nbsp;None&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;amount&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.lt_eq_cases"><span class="id" title="lemma">N.lt_eq_cases</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">sender_enough_balance</span> <span class="id" title="keyword">as</span> []; [<span class="id" title="var">lia</span> | <span class="id" title="tactic">subst</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">FMap_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;case:&nbsp;from&nbsp;&lt;&gt;&nbsp;to&nbsp;&amp;&amp;&nbsp;find&nbsp;from&nbsp;=&nbsp;Some&nbsp;n&nbsp;&amp;&amp;&nbsp;amount&nbsp;&lt;=&nbsp;n&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.sub_add"><span class="id" title="lemma">N.sub_add</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> !<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.eqb_refl"><span class="id" title="lemma">N.eqb_refl</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;case:&nbsp;from&nbsp;&lt;&gt;&nbsp;to&nbsp;&amp;&amp;&nbsp;find&nbsp;from&nbsp;=&nbsp;None&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;amount&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.lt_eq_cases"><span class="id" title="lemma">N.lt_eq_cases</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">sender_enough_balance</span> <span class="id" title="keyword">as</span> []; [<span class="id" title="var">lia</span> | <span class="id" title="tactic">subst</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.eqb_refl"><span class="id" title="lemma">N.eqb_refl</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#Dexter2Lqt.try_transfer"><span class="id" title="definition">try_transfer</span></a></span> does not change the total supply of tokens 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_preserves_total_supply"><span class="id" title="lemma">try_transfer_preserves_total_supply</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer"><span class="id" title="constructor">transfer</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#total_supply"><span class="id" title="projection">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#total_supply"><span class="id" title="projection">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#Dexter2Lqt.try_transfer"><span class="id" title="definition">try_transfer</span></a></span> does not change allowances 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_preserves_allowances"><span class="id" title="lemma">try_transfer_preserves_allowances</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer"><span class="id" title="constructor">transfer</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#allowances"><span class="id" title="projection">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#allowances"><span class="id" title="projection">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#Dexter2Lqt.try_transfer"><span class="id" title="definition">try_transfer</span></a></span> only modifies the <span class="inlinecode"><a class="idref" href="ConCert.Embedding.Examples.crowdfunding.CrowdfundingData.html#sender"><span class="id" title="definition">sender</span></a></span> and <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#to"><span class="id" title="projection">to</span></a></span> balances 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_preserves_other_balances"><span class="id" title="lemma">try_transfer_preserves_other_balances</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer"><span class="id" title="constructor">transfer</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">account</span>, <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span> <span class="id" title="var">account</span> <span class="id" title="var">account_not_sender</span> <span class="id" title="var">account_not_receiver</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">FMap_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If the requirements are met then then receive on transfer msg must succeed and
    if receive on transfer msg succeeds then requirements must hold 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_is_some"><span class="id" title="lemma">try_transfer_is_some</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span>,<br/>
&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#306329b0eca7a2b86c198702f594ad8e"><span class="id" title="notation">&lt;=</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#4bfb4f2d0721ba668e3a802ab1b745a1"><span class="id" title="notation">&lt;-&gt;</span></a> <a class="idref" href="ConCert.Execution.Extras.html#isSome"><span class="id" title="definition">isSome</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer"><span class="id" title="constructor">transfer</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>))) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> (<span class="id" title="var">amount_positive</span> &amp; <span class="id" title="var">sender_enough_balance</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>; <span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">amount_from</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">BoolElim</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.ltb_ge"><span class="id" title="lemma">N.ltb_ge</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">sender_enough_balance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">sender_enough_balance</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">amount_positive</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">amount_from</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">BoolElim</span> <span class="id" title="tactic">in</span> *.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab121"></a><h2 class="section">Transfer_from correct</h2>

<div class="paragraph"> </div>

 <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from"><span class="id" title="definition">try_transfer_from</span></a></span> correctly updates balance and allowance 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_from_balance_correct"><span class="id" title="lemma">try_transfer_from_balance_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer_from"><span class="id" title="constructor">transfer_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer_balance_update_correct"><span class="id" title="definition">transfer_balance_update_correct</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer_from_allowances_update_correct"><span class="id" title="definition">transfer_from_allowances_update_correct</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer_balance_update_correct"><span class="id" title="definition">transfer_balance_update_correct</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer_from_allowances_update_correct"><span class="id" title="definition">transfer_from_allowances_update_correct</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_allowance"><span class="id" title="definition">get_allowance</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">H</span> <span class="id" title="var">into</span> <span class="id" title="var">from_allowances</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">H0</span> <span class="id" title="var">into</span> <span class="id" title="var">sender_alloance</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">BoolElim</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">sender_enough_allowance</span> &amp; <span class="id" title="var">from_enough_balance</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;proof&nbsp;of&nbsp;balance&nbsp;updated&nbsp;correct&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <span class="id" title="var">from</span> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a> <span class="id" title="var">prev_state</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">from_bal_prev</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">from_bal_prev</span> || <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">from_bal_prev</span>); <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;case:&nbsp;from&nbsp;=&nbsp;&nbsp;to&nbsp;&amp;&amp;&nbsp;find&nbsp;from&nbsp;=&nbsp;Some&nbsp;n&nbsp;&amp;&amp;&nbsp;amount&nbsp;&lt;=&nbsp;n&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.sub_add"><span class="id" title="lemma">N.sub_add</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.eqb_refl"><span class="id" title="lemma">N.eqb_refl</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;case:&nbsp;from&nbsp;=&nbsp;&nbsp;to&nbsp;&amp;&amp;&nbsp;find&nbsp;from&nbsp;=&nbsp;None&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;amount&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.lt_eq_cases"><span class="id" title="lemma">N.lt_eq_cases</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">from_enough_balance</span> <span class="id" title="keyword">as</span> []; [<span class="id" title="var">lia</span> | <span class="id" title="tactic">subst</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">FMap_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;case:&nbsp;from&nbsp;&lt;&gt;&nbsp;to&nbsp;&amp;&amp;&nbsp;find&nbsp;from&nbsp;=&nbsp;Some&nbsp;n&nbsp;&amp;&amp;&nbsp;amount&nbsp;&lt;=&nbsp;n&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.sub_add"><span class="id" title="lemma">N.sub_add</span></a> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> ?<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.eqb_refl"><span class="id" title="lemma">N.eqb_refl</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;case:&nbsp;from&nbsp;&lt;&gt;&nbsp;to&nbsp;&amp;&amp;&nbsp;find&nbsp;from&nbsp;=&nbsp;None&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;amount&nbsp;=&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.lt_eq_cases"><span class="id" title="lemma">N.lt_eq_cases</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">from_enough_balance</span> <span class="id" title="keyword">as</span> []; [<span class="id" title="var">lia</span> | <span class="id" title="tactic">subst</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.eqb_refl"><span class="id" title="lemma">N.eqb_refl</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;proof&nbsp;of&nbsp;allowances&nbsp;updated&nbsp;correct&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>. <span class="id" title="var">FMap_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.sub_add"><span class="id" title="lemma">N.sub_add</span></a> <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.eqb_refl"><span class="id" title="lemma">N.eqb_refl</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from"><span class="id" title="definition">try_transfer_from</span></a></span> does not change total supply of tokens 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_from_preserves_total_supply"><span class="id" title="lemma">try_transfer_from_preserves_total_supply</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer_from"><span class="id" title="constructor">transfer_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#total_supply"><span class="id" title="projection">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#total_supply"><span class="id" title="projection">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from"><span class="id" title="definition">try_transfer_from</span></a></span> only changes <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#from"><span class="id" title="projection">from</span></a></span> and <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#to"><span class="id" title="projection">to</span></a></span> balances 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_from_preserves_other_balances"><span class="id" title="lemma">try_transfer_from_preserves_other_balances</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer_from"><span class="id" title="constructor">transfer_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">account</span>, <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span> <span class="id" title="var">account</span> <span class="id" title="var">account_not_from</span> <span class="id" title="var">account_not_to</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">FMap_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from"><span class="id" title="definition">try_transfer_from</span></a></span> only changes allowance map of <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#from"><span class="id" title="projection">from</span></a></span> 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_from_preserves_other_allowances"><span class="id" title="lemma">try_transfer_from_preserves_other_allowances</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer_from"><span class="id" title="constructor">transfer_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">account</span>, <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#allowances"><span class="id" title="projection">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#allowances"><span class="id" title="projection">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span> <span class="id" title="var">account</span> <span class="id" title="var">account_not_from</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">FMap_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from"><span class="id" title="definition">try_transfer_from</span></a></span> only changes allowance of <span class="inlinecode"><a class="idref" href="ConCert.Embedding.Examples.crowdfunding.CrowdfundingData.html#sender"><span class="id" title="definition">sender</span></a></span> 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_from_preserves_other_allowance"><span class="id" title="lemma">try_transfer_from_preserves_other_allowance</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer_from"><span class="id" title="constructor">transfer_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">account</span>, <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_allowance"><span class="id" title="definition">get_allowance</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_allowance"><span class="id" title="definition">get_allowance</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span> <span class="id" title="var">account</span> <span class="id" title="var">account_not_sender</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_allowance"><span class="id" title="definition">get_allowance</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">FMap_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Keyed</span> <span class="id" title="var">Unification</span>.<br/>

<br/>
</div>

<div class="doc">
If the requirements are met then then receive on transfer_from msg must succeed and
    if receive on transfer_from msg succeeds then requirements must hold 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_from_is_some"><span class="id" title="lemma">try_transfer_from_is_some</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">get_allowance_</span> <span class="id" title="var">account</span> := <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> (@<a class="idref" href="ConCert.Execution.Containers.html#FMap.empty"><span class="id" title="abbreviation">FMap.empty</span></a> (<a class="idref" href="ConCert.Execution.Containers.html#FMap"><span class="id" title="abbreviation">FMap</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#TokenValue"><span class="id" title="definition">TokenValue</span></a>) <span class="id" title="var">_</span>) (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#allowances"><span class="id" title="projection">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a>))) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#0f6d3b46a03d1336a5ac68936077dc02"><span class="id" title="notation">&gt;?</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Extras.html#isSome"><span class="id" title="definition">isSome</span></a> (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#allowances"><span class="id" title="projection">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Extras.html#isSome"><span class="id" title="definition">isSome</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_allowance_"><span class="id" title="variable">get_allowance_</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a>))<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_allowance_"><span class="id" title="variable">get_allowance_</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#4bfb4f2d0721ba668e3a802ab1b745a1"><span class="id" title="notation">&lt;-&gt;</span></a> <a class="idref" href="ConCert.Execution.Extras.html#isSome"><span class="id" title="definition">isSome</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer_from"><span class="id" title="constructor">transfer_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>))) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">sender_amount_zero</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="var">contract_simpl</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">sender_amount_zero</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">get_allowance_</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">get_allowance_</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> (<span class="id" title="var">from_allowances_some</span> &amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sender_allowance</span> &amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">from_enough_balance</span>%<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.ltb_ge"><span class="id" title="lemma">N.ltb_ge</span></a> &amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sender_enough_allowance</span>%<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.ltb_ge"><span class="id" title="lemma">N.ltb_ge</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">allowances_ctx</span>;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">from_allowances_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">allowance_ctx</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">allowance_ctx</span> <span class="id" title="tactic">in</span> <span class="id" title="var">sender_allowance</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">allowance_ctx</span> <span class="id" title="tactic">in</span> <span class="id" title="var">sender_enough_allowance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">clear</span> <span class="id" title="var">sender_allowance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">amount_from</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">from_enough_balance</span> <span class="id" title="tactic">in</span> <span class="id" title="var">amount_from</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">sender_enough_allowance</span> <span class="id" title="tactic">in</span> <span class="id" title="var">amount_from</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;destruct_match&nbsp;eqn:allowances_ctx&nbsp;in&nbsp;receive_some;&nbsp;rewrite&nbsp;allowances_ctx;&nbsp;try&nbsp;discriminate.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">allowances_ctx</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;destruct_match&nbsp;eqn:allowance_ctx&nbsp;in&nbsp;receive_some;&nbsp;rewrite&nbsp;allowance_ctx;&nbsp;try&nbsp;discriminate.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">allowance_ctx</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">amount_from</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">BoolElim</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">allowance_ctx</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab122"></a><h2 class="section">Approve correct</h2>

<div class="paragraph"> </div>

 <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#Dexter2Lqt.try_approve"><span class="id" title="definition">try_approve</span></a></span> correctly replaces allowance 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_approve_allowance_correct"><span class="id" title="lemma">try_approve_allowance_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#approve"><span class="id" title="constructor">approve</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#approve_allowance_update_correct"><span class="id" title="definition">approve_allowance_update_correct</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#approve_allowance_update_correct"><span class="id" title="definition">approve_allowance_update_correct</span></a>, <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_allowance"><span class="id" title="definition">get_allowance</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">from_allowance</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>; <span class="id" title="var">cbn</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap_simpl</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.eqb_refl"><span class="id" title="lemma">N.eqb_refl</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#Dexter2Lqt.try_approve"><span class="id" title="definition">try_approve</span></a></span> does not change total supply of tokens 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_approve_preserves_total_supply"><span class="id" title="lemma">try_approve_preserves_total_supply</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#approve"><span class="id" title="constructor">approve</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#total_supply"><span class="id" title="projection">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#total_supply"><span class="id" title="projection">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#Dexter2Lqt.try_approve"><span class="id" title="definition">try_approve</span></a></span> does not change balances 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_approve_preserves_balances"><span class="id" title="lemma">try_approve_preserves_balances</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#approve"><span class="id" title="constructor">approve</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#balances"><span class="id" title="projection">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#Dexter2Lqt.try_approve"><span class="id" title="definition">try_approve</span></a></span> does not change allowances map of other addresses 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_approve_preserves_other_allowances"><span class="id" title="lemma">try_approve_preserves_other_allowances</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#approve"><span class="id" title="constructor">approve</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">account</span>, <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#allowances"><span class="id" title="projection">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#allowances"><span class="id" title="projection">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span> <span class="id" title="var">account</span> <span class="id" title="var">account_not_sender</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="var">FMap_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.dexter2.Dexter2FA12.html#Dexter2Lqt.try_approve"><span class="id" title="definition">try_approve</span></a></span> does not change allowance of other addresses 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_approve_preserves_other_allowance"><span class="id" title="lemma">try_approve_preserves_other_allowance</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#approve"><span class="id" title="constructor">approve</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">account</span>, <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_allowance"><span class="id" title="definition">get_allowance</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a>) <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_allowance"><span class="id" title="definition">get_allowance</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a>) <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#account"><span class="id" title="variable">account</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span> <span class="id" title="var">account</span> <span class="id" title="var">account_not_delegate</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#get_allowance"><span class="id" title="definition">get_allowance</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">allowances_from</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="var">FMap_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If the requirements are met then then receive on approve msg must succeed and
    if receive on approve msg succeeds then requirements must hold 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_approve_is_some"><span class="id" title="lemma">try_approve_is_some</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span>,<br/>
&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#0f6d3b46a03d1336a5ac68936077dc02"><span class="id" title="notation">&gt;?</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#4bfb4f2d0721ba668e3a802ab1b745a1"><span class="id" title="notation">&lt;-&gt;</span></a> <a class="idref" href="ConCert.Execution.Extras.html#isSome"><span class="id" title="definition">isSome</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#state"><span class="id" title="variable">state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#approve"><span class="id" title="constructor">approve</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>))) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">sender_amount_zero</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">sender_amount_zero</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">destruct_match</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">destruct_match</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab123"></a><h2 class="section">EIP20 functions preserve sum of balances</h2>

<div class="paragraph"> </div>

 Sum of all balances remain the same after proccessing transfer msg 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_preserves_balances_sum"><span class="id" title="lemma">try_transfer_preserves_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer"><span class="id" title="constructor">transfer</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sum_balances"><span class="id" title="definition">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sum_balances"><span class="id" title="definition">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">H</span> <span class="id" title="var">into</span> <span class="id" title="var">sender_enough_balance</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.ltb_ge"><span class="id" title="lemma">N.ltb_ge</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">sender_enough_balance</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sum_balances"><span class="id" title="definition">sum_balances</span></a>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sumN_FMap_add_sub"><span class="id" title="lemma">sumN_FMap_add_sub</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Sum of all balances remain the same after proccessing transfer_from msg 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_from_preserves_balances_sum"><span class="id" title="lemma">try_transfer_from_preserves_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#transfer_from"><span class="id" title="constructor">transfer_from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sum_balances"><span class="id" title="definition">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sum_balances"><span class="id" title="definition">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">BoolElim</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sum_balances"><span class="id" title="definition">sum_balances</span></a>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sumN_FMap_add_sub"><span class="id" title="lemma">sumN_FMap_add_sub</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Sum of all balances remain the same after approve transfer msg 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="try_approve_preserves_balances_sum"><span class="id" title="lemma">try_approve_preserves_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#approve"><span class="id" title="constructor">approve</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sum_balances"><span class="id" title="definition">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sum_balances"><span class="id" title="definition">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab124"></a><h2 class="section">Contract never produces any actions</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="outgoing_acts_nil"><span class="id" title="lemma">outgoing_acts_nil</span></a> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">bstate</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainState"><span class="id" title="record">ChainState</span></a>) (<span class="id" title="var">caddr</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#contract"><span class="id" title="definition">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#outgoing_acts"><span class="id" title="definition">outgoing_acts</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#lift_outgoing_acts_nil"><span class="id" title="lemma">lift_outgoing_acts_nil</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#contract"><span class="id" title="definition">contract</span></a>); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#EIP20_no_acts"><span class="id" title="lemma">EIP20_no_acts</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab125"></a><h2 class="section">Total supply always equals inial supply</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="total_supply_eq_init_supply"><span class="id" title="lemma">total_supply_eq_init_supply</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span> (<span class="id" title="var">trace</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#empty_state"><span class="id" title="definition">empty_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#bstate"><span class="id" title="variable">bstate</span></a>) :<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#contract"><span class="id" title="definition">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">deploy_info</span> <span class="id" title="var">cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#deployment_info"><span class="id" title="definition">deployment_info</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#trace"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#deploy_info"><span class="id" title="variable">deploy_info</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#contract_state"><span class="id" title="definition">contract_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#cstate"><span class="id" title="variable">cstate</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="keyword">let</span> <span class="id" title="var">init_supply</span> := <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#init_amount"><span class="id" title="projection">init_amount</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#deploy_info"><span class="id" title="variable">deploy_info</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#deployment_setup"><span class="id" title="projection">deployment_setup</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#init_supply"><span class="id" title="variable">init_supply</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#total_supply"><span class="id" title="projection">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#cstate"><span class="id" title="variable">cstate</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#lift_dep_info_contract_state_prop"><span class="id" title="lemma">lift_dep_info_contract_state_prop</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#contract"><span class="id" title="definition">contract</span></a>); <span class="id" title="tactic">intros</span> *.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">IH</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_message</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_preserves_total_supply"><span class="id" title="lemma">try_transfer_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from_preserves_total_supply"><span class="id" title="lemma">try_transfer_from_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_approve_preserves_total_supply"><span class="id" title="lemma">try_approve_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab126"></a><h2 class="section">Sum of balances always equals total supply</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="sum_balances_eq_total_supply"><span class="id" title="lemma">sum_balances_eq_total_supply</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span> :<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#contract"><span class="id" title="definition">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#contract_state"><span class="id" title="definition">contract_state</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#cstate"><span class="id" title="variable">cstate</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#total_supply"><span class="id" title="projection">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#cstate"><span class="id" title="variable">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sum_balances"><span class="id" title="definition">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#cstate"><span class="id" title="variable">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#lift_contract_state_prop"><span class="id" title="lemma">lift_contract_state_prop</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#contract"><span class="id" title="definition">contract</span></a>); <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">intros</span> *.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion_clear</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sum_balances"><span class="id" title="definition">sum_balances</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.elements_add"><span class="id" title="lemma">FMap.elements_add</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.elements_empty"><span class="id" title="lemma">FMap.elements_empty</span></a>. <span class="id" title="var">cbn</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">IH</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_message</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_preserves_balances_sum"><span class="id" title="lemma">try_transfer_preserves_balances_sum</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_preserves_total_supply"><span class="id" title="lemma">try_transfer_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from_preserves_balances_sum"><span class="id" title="lemma">try_transfer_from_preserves_balances_sum</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from_preserves_total_supply"><span class="id" title="lemma">try_transfer_from_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_approve_preserves_balances_sum"><span class="id" title="lemma">try_approve_preserves_balances_sum</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_approve_preserves_total_supply"><span class="id" title="lemma">try_approve_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">IH</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#EIP20Token.Theories"><span class="id" title="section">Theories</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#EIP20Token"><span class="id" title="section">EIP20Token</span></a>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a> and <a href="https://github.com/jgallen23/toc">TOC</a>
</div>
</div>
<script>
  const elements = document.getElementsByClassName("libtitle");
  while(elements.length > 0){
        elements[0].parentNode.removeChild(elements[0]);
  }
  if (window.location.pathname.endsWith("/toc.html")) {
      const jstocDiv = document.getElementById("js-toc");
      jstocDiv.classList.remove("toc");
      jstocDiv.classList.add("jstoc-hidden");
      const jstocHeaderDiv = document.getElementById("js-toc-header");
      jstocHeaderDiv.classList.add("jstoc-hidden");
  }
  console.log(window.location.pathname);
</script>
<script type="text/javascript" src="toc.js"></script>
</body>

</html>
