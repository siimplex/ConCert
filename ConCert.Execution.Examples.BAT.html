<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<link href="coqdocjs.css" rel="stylesheet" type="text/css"/>
<link href="toc.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="coqdocjs.js"></script>
</head>

<body onload="document.getElementById('content').focus()">
  <div id="header">
    <span class="left">
      <span class="modulename"> <script> document.write(document.title) </script> </span>
    </span>

    <span class="button" id="toggle-proofs"></span>

    <span class="right">
      <a href="toc.html">Table of contents</a>
      <a href="https://github.com/AU-COBRA/ConCert" target="_balnk">Project Page</a>
    </span>
</div>
  <div id="content" tabindex="-1" onblur="document.getElementById('content').focus()">
    <div id="js-toc-header" class="toc-header">Contents:</div>
    <div id="js-toc" class="toc" data-toc="h1,h2,h3,h4" data-toc-container="doc">
    </div>
    <div id="main">
<h1 class="libtitle">Library ConCert.Execution.Examples.BAT</h1>

<div class="code">
</div>

<div class="doc">
<a name="lab127"></a><h1 class="section">Basic Attention Token contract</h1>
 Implementation of the Basic Attention Token.
    Ported from https://github.com/brave-intl/basic-attention-token-crowdsale/blob/66c886cc4bfb0493d9e7980f392ca7921ef1e7fc/contracts/BAToken.sol

<div class="paragraph"> </div>

    This file contains contract function definitions and proofs.
    All contract types and utility functions are defined in <span class="inlinecode"><span class="id" title="library">ConCert.Execution.Examples.BATCommon</span></span>.

<div class="paragraph"> </div>

    The BAT contract is a combination of a EIP20 token contract and a crowdsale contract.
    This implementation extends the EIP20 contract implemented in <span class="inlinecode"><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#"><span class="id" title="library">ConCert.Execution.Examples.EIP20Token</span></a></span>.

</div>
<div class="code">
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.micromega.Lia.html#"><span class="id" title="library">Lia</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#"><span class="id" title="library">List</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.ZArith.html#"><span class="id" title="library">ZArith</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Utils.Automation.html#"><span class="id" title="library">Automation</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Utils.RecordUpdate.html#"><span class="id" title="library">RecordUpdate</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Blockchain.html#"><span class="id" title="library">Blockchain</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#"><span class="id" title="library">BuildUtils</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Containers.html#"><span class="id" title="library">Containers</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Extras.html#"><span class="id" title="library">Extras</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Monads.html#"><span class="id" title="library">Monads</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Serializable.html#"><span class="id" title="library">Serializable</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution.Examples</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#"><span class="id" title="library">BATCommon</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution.Examples</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="ConCert.Execution.Examples.Common.html#"><span class="id" title="library">Common</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution.Examples</span> <span class="id" title="keyword">Require</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#"><span class="id" title="library">EIP20Token</span></a>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">RecordSetNotations</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab128"></a><h1 class="section">Contract functions</h1>

</div>
<div class="code">
<span class="id" title="keyword">Section</span> <a name="BAT"><span class="id" title="section">BAT</span></a>.<br/>
<span class="id" title="keyword">Context</span> {<span class="id" title="var">BaseTypes</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainBase"><span class="id" title="class">ChainBase</span></a>}.<br/>

<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">N_scope</span>.<br/>
</div>

<div class="doc">
<a name="lab129"></a><h2 class="section">Init</h2>
 This function only gets called once when contract is deployed.
    Will set up the initial storage state of the contract.

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a name="init"><span class="id" title="definition">init</span></a> (<span class="id" title="var">chain</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ctx</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">setup</span> : <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#Setup"><span class="id" title="record">Setup</span></a>) : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#State"><span class="id" title="record">State</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">token_state</span> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">EIP20Token.balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">FMap.add</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">setup</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">.(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">_batFundDeposit</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">)</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">setup</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">.(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">_batFund</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">)</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">FMap.empty</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">EIP20Token.total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">setup</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">.(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">_batFund</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">);</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">EIP20Token.allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">FMap.empty</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|} <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
EIP20Token initialisation: 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">token_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">token_state</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
BAT initialisation: 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">initSupply</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">setup</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">.(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">_batFund</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">);</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">isFinalized</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">false</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">fundDeposit</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">setup</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">.(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">_fundDeposit</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">);</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">batFundDeposit</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">setup</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">.(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">_batFundDeposit</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">);</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">fundingStart</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">setup</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">.(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">_fundingStart</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">);</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">fundingEnd</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">setup</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">.(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">_fundingEnd</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">);</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">tokenExchangeRate</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">setup</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">.(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">_tokenExchangeRate</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">);</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">tokenCreationCap</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">setup</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">.(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">_tokenCreationCap</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">);</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">tokenCreationMin</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">setup</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">.(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">_tokenCreationMin</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#build_state"><span class="id" title="constructor">);</span></a><br/>
&nbsp;&nbsp;|}.<br/>

<br/>
</div>

<div class="doc">
<a name="lab130"></a><h2 class="section">Create Tokens</h2>
 This entrypoint allows users to fund the crowdsale in return for tokens 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a name="try_create_tokens"><span class="id" title="definition">try_create_tokens</span></a> <span class="id" title="var">sender</span> (<span class="id" title="var">sender_payload</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a>) <span class="id" title="var">current_slot</span> <span class="id" title="var">state</span> :=<br/>
&nbsp;<span class="comment">(*&nbsp;early&nbsp;return&nbsp;if&nbsp;funding&nbsp;is&nbsp;finalized,&nbsp;funding&nbsp;period&nbsp;hasn't&nbsp;started&nbsp;yet,&nbsp;or&nbsp;funding&nbsp;period&nbsp;is&nbsp;over&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.Examples.Common.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb"><span class="id" title="definition">Nat.ltb</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#current_slot"><span class="id" title="variable">current_slot</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingStart"><span class="id" title="projection">fundingStart</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb"><span class="id" title="definition">Nat.ltb</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a>) <a class="idref" href="ConCert.Execution.Examples.BAT.html#current_slot"><span class="id" title="variable">current_slot</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">)</span></a>) <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc">
Here we deviate slightly from the reference implementation. They only check for = 0,
      but since ConCert's payloads may be negative numbers, we must extend this check to &lt;= 0 
</div>
<div class="code">
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.Examples.Common.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.leb"><span class="id" title="definition">Z.leb</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#sender_payload"><span class="id" title="variable">sender_payload</span></a> 0) <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc">
Note: this conversion from Z to N is safe because by assumption sender_payload &gt; 0 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">tokens</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.to_N"><span class="id" title="definition">Z.to_N</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#sender_payload"><span class="id" title="variable">sender_payload</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">checkedSupply</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#tokens"><span class="id" title="variable">tokens</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.Examples.Common.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationCap"><span class="id" title="projection">tokenCreationCap</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#b39870dee55afcd85c6b795fb34de165"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#checkedSupply"><span class="id" title="variable">checkedSupply</span></a>) <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_token_state</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">EIP20Token.State</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">EIP20Token.total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">checkedSupply</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">EIP20Token.balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">FMap.partial_alter</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">fun</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">balance</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">=&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">with_default</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">0</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">balance</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">+</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">tokens</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">))</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">sender</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">state</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">);</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">EIP20Token.allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">state</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;|} <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_token_state"><span class="id" title="variable">new_token_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab131"></a><h2 class="section">Refund</h2>
 This entrypoint can be called if crowdsale is not successfully funded.
    Users calling this entrypoint will have their tokens removed and get their money refunded.

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a name="try_refund"><span class="id" title="definition">try_refund</span></a> <span class="id" title="var">sender</span> <span class="id" title="var">current_slot</span> <span class="id" title="var">state</span> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc">
Early return if funding is finalized, or funding period is NOT over, or if total supply exceeds or is equal to the minimum fund tokens. 
</div>
<div class="code">
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.Examples.Common.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Arith.PeanoNat.html#Nat.leb"><span class="id" title="definition">Nat.leb</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#current_slot"><span class="id" title="variable">current_slot</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#05335162eaa480b4616c18e1c329eb57"><span class="id" title="notation">&lt;=?</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#05335162eaa480b4616c18e1c329eb57"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#05335162eaa480b4616c18e1c329eb57"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">)</span></a>) <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc">
Don't allow the the batFundDeposit account to refund 
</div>
<div class="code">
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.Examples.Common.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqb"><span class="id" title="method">address_eqb</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#sender"><span class="id" title="variable">sender</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a>)) <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">sender_bats</span> <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#sender"><span class="id" title="variable">sender</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>) <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.Examples.Common.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#sender_bats"><span class="id" title="variable">sender_bats</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#59a5ff4a6cbb127625aba1a377a243d1"><span class="id" title="notation">=?</span></a> 0) <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_total_supply</span> := (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a>) <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">-</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#sender_bats"><span class="id" title="variable">sender_bats</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;</div>

<div class="doc">
Convert tokens back to the currency of the blockchain, to be sent back to the sender address 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">amount_to_send</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.of_N"><span class="id" title="definition">Z.of_N</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#sender_bats"><span class="id" title="variable">sender_bats</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#be3f246709fdc565d9577f86645e6da3"><span class="id" title="notation">/</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a>)) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_token_state</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#State"><span class="id" title="record">EIP20Token.State</span></a> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">EIP20Token.total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">new_total_supply</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">EIP20Token.balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">FMap.add</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">sender</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">0</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">(</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">state</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">);</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">EIP20Token.allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">state</span></a><a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#build_state"><span class="id" title="constructor">;</span></a><br/>
&nbsp;&nbsp;|} <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_state</span> := <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_token_state"><span class="id" title="variable">new_token_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">send_act</span> := <a class="idref" href="ConCert.Execution.Blockchain.html#act_transfer"><span class="id" title="constructor">act_transfer</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#sender"><span class="id" title="variable">sender</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount_to_send"><span class="id" title="variable">amount_to_send</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#send_act"><span class="id" title="variable">send_act</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab132"></a><h2 class="section">Finalize</h2>
 This entrypoint will end the crowdsale and pay out the money to the owner.
    Can only be called if funding was successful.

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a name="try_finalize"><span class="id" title="definition">try_finalize</span></a> <span class="id" title="var">sender</span> <span class="id" title="var">current_slot</span> <span class="id" title="var">contract_balance</span> <span class="id" title="var">state</span> :=<br/>
&nbsp;&nbsp;</div>

<div class="doc">
Early return if funding is finalized, or if sender is NOT the fund deposit address,
      or if the total token supply is less than the minimum required amount,
      or if it is too early to end funding and the total token supply has not reached the cap.
      Note: the last requirement makes it possible to end a funding early if the cap has been reached.
  
</div>
<div class="code">
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.Examples.Common.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqb"><span class="id" title="method">address_eqb</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#sender"><span class="id" title="variable">sender</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a>))<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">||</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#b39870dee55afcd85c6b795fb34de165"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#b39870dee55afcd85c6b795fb34de165"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#b39870dee55afcd85c6b795fb34de165"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#081ff67d3116402bb680e8692aa39185"><span class="id" title="notation">)</span></a>) <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.Examples.Common.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Arith.PeanoNat.html#Nat.leb"><span class="id" title="definition">Nat.leb</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#current_slot"><span class="id" title="variable">current_slot</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#9ddeac0ab66152bd1d64bedb507a795e"><span class="id" title="notation">&amp;&amp;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#negb"><span class="id" title="definition">negb</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#59a5ff4a6cbb127625aba1a377a243d1"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#59a5ff4a6cbb127625aba1a377a243d1"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#59a5ff4a6cbb127625aba1a377a243d1"><span class="id" title="notation">=?</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationCap"><span class="id" title="projection">tokenCreationCap</span></a>))) <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;</div>

<div class="doc">
Send the currency of the contract back to the fund 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">send_act</span> := <a class="idref" href="ConCert.Execution.Blockchain.html#act_transfer"><span class="id" title="constructor">act_transfer</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a>) <a class="idref" href="ConCert.Execution.Examples.BAT.html#contract_balance"><span class="id" title="variable">contract_balance</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_state</span> := <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#send_act"><span class="id" title="variable">send_act</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab133"></a><h2 class="section">Receive</h2>
 This is the main entrypoint function.
    All contract calls will be handled by this function

</div>
<div class="code">
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>
<span class="id" title="keyword">Definition</span> <a name="receive_bat"><span class="id" title="definition">receive_bat</span></a> (<span class="id" title="var">chain</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ctx</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">state</span> : <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">maybe_msg</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#Msg"><span class="id" title="inductive">Msg</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#State"><span class="id" title="record">State</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">*</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#ActionBody"><span class="id" title="inductive">ActionBody</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">sender</span> := <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">sender_payload</span> := <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">slot</span> := <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">contract_balance</span> := <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_contract_balance"><span class="id" title="projection">ctx_contract_balance</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">without_actions</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option_map"><span class="id" title="definition">option_map</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">new_state</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">not_payable</span> <span class="id" title="var">x</span> := <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.Examples.Common.html#throwIf"><span class="id" title="definition">throwIf</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#sender_payload"><span class="id" title="variable">sender_payload</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#0f6d3b46a03d1336a5ac68936077dc02"><span class="id" title="notation">&gt;?</span></a> 0) <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#x"><span class="id" title="variable">x</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#maybe_msg"><span class="id" title="variable">maybe_msg</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a> =&gt; <a class="idref" href="ConCert.Execution.Examples.BAT.html#without_actions"><span class="id" title="variable">without_actions</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#try_create_tokens"><span class="id" title="definition">try_create_tokens</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#sender"><span class="id" title="variable">sender</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#sender_payload"><span class="id" title="variable">sender_payload</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#slot"><span class="id" title="variable">slot</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a> =&gt; <a class="idref" href="ConCert.Execution.Examples.BAT.html#not_payable"><span class="id" title="variable">not_payable</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#try_refund"><span class="id" title="definition">try_refund</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#sender"><span class="id" title="variable">sender</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#slot"><span class="id" title="variable">slot</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>)<br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#finalize"><span class="id" title="constructor">finalize</span></a> =&gt; <a class="idref" href="ConCert.Execution.Examples.BAT.html#not_payable"><span class="id" title="variable">not_payable</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#try_finalize"><span class="id" title="definition">try_finalize</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#sender"><span class="id" title="variable">sender</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#slot"><span class="id" title="variable">slot</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#contract_balance"><span class="id" title="variable">contract_balance</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Close</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">Z_scope</span>.<br/>

<br/>
</div>

<div class="doc">
Composes EIP20Token.receive and receive_bat by first executing EIP20Token.receive (if the message is an EIP20 message),
   and otherwise executes receive_bat 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <a name="receive"><span class="id" title="definition">receive</span></a> (<span class="id" title="var">chain</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Chain"><span class="id" title="record">Chain</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ctx</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ContractCallContext"><span class="id" title="record">ContractCallContext</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">state</span> : <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#State"><span class="id" title="record">State</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">maybe_msg</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#Msg"><span class="id" title="inductive">Msg</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#State"><span class="id" title="record">State</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac4"><span class="id" title="notation">*</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#ActionBody"><span class="id" title="inductive">ActionBody</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#maybe_msg"><span class="id" title="variable">maybe_msg</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenMsg"><span class="id" title="constructor">tokenMsg</span></a> <span class="id" title="var">msg</span>) =&gt; <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">do</span></a> <span class="id" title="var">res</span> <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">&lt;-</span></a> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#receive"><span class="id" title="definition">EIP20Token.receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a>) (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">msg</span>) <a class="idref" href="ConCert.Execution.Monads.html#bbeef38f67325be53cb9324ba9182131"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_state</span> := <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#res"><span class="id" title="variable">res</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#res"><span class="id" title="variable">res</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <a class="idref" href="ConCert.Execution.Examples.BAT.html#receive_bat"><span class="id" title="definition">receive_bat</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#maybe_msg"><span class="id" title="variable">maybe_msg</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a name="contract"><span class="id" title="definition">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#Contract"><span class="id" title="record">Contract</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#Setup"><span class="id" title="record">Setup</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#Msg"><span class="id" title="inductive">Msg</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#State"><span class="id" title="record">State</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#build_contract"><span class="id" title="constructor">build_contract</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#init"><span class="id" title="definition">init</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab134"></a><h1 class="section">Contract properties</h1>

</div>
<div class="code">
<span class="id" title="keyword">Section</span> <a name="BAT.Theories"><span class="id" title="section">Theories</span></a>.<br/>
<span class="comment">(*&nbsp;begind&nbsp;hide&nbsp;*)</span><br/>
<span class="comment">(*&nbsp;Tactics&nbsp;to&nbsp;simplify&nbsp;proof&nbsp;steps&nbsp;*)</span><br/>
<span class="id" title="keyword">Tactic Notation</span> "contract_simpl" := <span class="id" title="var">contract_simpl</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#init"><span class="id" title="definition">init</span></a>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">destruct_message</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">msg</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#Msg"><span class="id" title="inductive">Msg</span></a> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">msg</span> : <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#Msg"><span class="id" title="inductive">Msg</span></a> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">msg</span> : <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#Msg"><span class="id" title="inductive">EIP20Token.Msg</span></a> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#receive"><span class="id" title="projection">Blockchain.receive</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_</span> |- <span class="id" title="var">_</span> =&gt; <span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.ltb_lt"><span class="id" title="lemma">N.ltb_lt</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.ltb_ge"><span class="id" title="lemma">N.ltb_ge</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.leb_le"><span class="id" title="lemma">N.leb_le</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.leb_gt"><span class="id" title="lemma">N.leb_gt</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.eqb_eq"><span class="id" title="lemma">N.eqb_eq</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.eqb_neq"><span class="id" title="lemma">N.eqb_neq</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb_lt"><span class="id" title="lemma">Nat.ltb_lt</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb_ge"><span class="id" title="lemma">Nat.ltb_ge</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Arith.PeanoNat.html#Nat.leb_le"><span class="id" title="lemma">Nat.leb_le</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Arith.PeanoNat.html#Nat.leb_gt"><span class="id" title="lemma">Nat.leb_gt</span></a> <br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.leb_le"><span class="id" title="lemma">Z.leb_le</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.leb_gt"><span class="id" title="lemma">Z.leb_gt</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Bool.Bool.html#orb_true_iff"><span class="id" title="lemma">Bool.orb_true_iff</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Bool.Bool.html#orb_false_iff"><span class="id" title="lemma">Bool.orb_false_iff</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Bool.Bool.html#andb_true_iff"><span class="id" title="lemma">Bool.andb_true_iff</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Bool.Bool.html#andb_false_iff"><span class="id" title="lemma">Bool.andb_false_iff</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Bool.Bool.html#negb_false_iff"><span class="id" title="lemma">Bool.negb_false_iff</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Bool.Bool.html#negb_true_iff"><span class="id" title="lemma">Bool.negb_true_iff</span></a> : <span class="id" title="var">BoolElim</span>.<br/>
<span class="comment">(*&nbsp;end&nbsp;hide&nbsp;*)</span><br/>

<br/>
</div>

<div class="doc">
<a name="lab135"></a><h2 class="section">Transfer correct</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_balance_correct"><span class="id" title="lemma">try_transfer_balance_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#transfer"><span class="id" title="definition">transfer</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#transfer_balance_update_correct"><span class="id" title="abbreviation">transfer_balance_update_correct</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>) (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>) <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_balance_correct"><span class="id" title="lemma">EIP20Token.try_transfer_balance_correct</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_preserves_total_supply"><span class="id" title="lemma">try_transfer_preserves_total_supply</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#transfer"><span class="id" title="definition">transfer</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_preserves_total_supply"><span class="id" title="lemma">EIP20Token.try_transfer_preserves_total_supply</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_preserves_allowances"><span class="id" title="lemma">try_transfer_preserves_allowances</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#transfer"><span class="id" title="definition">transfer</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_preserves_allowances"><span class="id" title="lemma">EIP20Token.try_transfer_preserves_allowances</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_preserves_other_balances"><span class="id" title="lemma">try_transfer_preserves_other_balances</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#transfer"><span class="id" title="definition">transfer</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">account</span>, <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span> <span class="id" title="var">account</span> <span class="id" title="var">account_not_sender</span> <span class="id" title="var">account_not_to</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_preserves_other_balances"><span class="id" title="lemma">EIP20Token.try_transfer_preserves_other_balances</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_is_some"><span class="id" title="lemma">try_transfer_is_some</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span>,<br/>
&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#306329b0eca7a2b86c198702f594ad8e"><span class="id" title="notation">&lt;=</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#4bfb4f2d0721ba668e3a802ab1b745a1"><span class="id" title="notation">&lt;-&gt;</span></a> <a class="idref" href="ConCert.Execution.Extras.html#isSome"><span class="id" title="definition">isSome</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#transfer"><span class="id" title="definition">transfer</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>))) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">receive</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_is_some"><span class="id" title="lemma">EIP20Token.try_transfer_is_some</span></a>, <a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab136"></a><h2 class="section">Transfer_from correct</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_from_balance_correct"><span class="id" title="lemma">try_transfer_from_balance_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#transfer_from"><span class="id" title="definition">transfer_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#transfer_balance_update_correct"><span class="id" title="abbreviation">transfer_balance_update_correct</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>) (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>) <a class="idref" href="ConCert.Execution.Examples.BAT.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#transfer_from_allowances_update_correct"><span class="id" title="abbreviation">transfer_from_allowances_update_correct</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>) (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>) <a class="idref" href="ConCert.Execution.Examples.BAT.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from_balance_correct"><span class="id" title="lemma">EIP20Token.try_transfer_from_balance_correct</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_from_preserves_total_supply"><span class="id" title="lemma">try_transfer_from_preserves_total_supply</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#transfer_from"><span class="id" title="definition">transfer_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from_preserves_total_supply"><span class="id" title="lemma">EIP20Token.try_transfer_from_preserves_total_supply</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_from_preserves_other_balances"><span class="id" title="lemma">try_transfer_from_preserves_other_balances</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#transfer_from"><span class="id" title="definition">transfer_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">account</span>, <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from_preserves_other_balances"><span class="id" title="lemma">EIP20Token.try_transfer_from_preserves_other_balances</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_from_preserves_other_allowances"><span class="id" title="lemma">try_transfer_from_preserves_other_allowances</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#transfer_from"><span class="id" title="definition">transfer_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">account</span>, <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from_preserves_other_allowances"><span class="id" title="lemma">EIP20Token.try_transfer_from_preserves_other_allowances</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_from_preserves_other_allowance"><span class="id" title="lemma">try_transfer_from_preserves_other_allowance</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#transfer_from"><span class="id" title="definition">transfer_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">account</span>, <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#get_allowance"><span class="id" title="abbreviation">get_allowance</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="ConCert.Execution.Examples.BAT.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#get_allowance"><span class="id" title="abbreviation">get_allowance</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>) <a class="idref" href="ConCert.Execution.Examples.BAT.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from_preserves_other_allowance"><span class="id" title="lemma">EIP20Token.try_transfer_from_preserves_other_allowance</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_from_is_some"><span class="id" title="lemma">try_transfer_from_is_some</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">get_allowance_</span> <span class="id" title="var">account</span> := <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> (@<a class="idref" href="ConCert.Execution.Containers.html#FMap.empty"><span class="id" title="abbreviation">FMap.empty</span></a> (<a class="idref" href="ConCert.Execution.Containers.html#FMap"><span class="id" title="abbreviation">FMap</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#TokenValue"><span class="id" title="definition">TokenValue</span></a>) <span class="id" title="var">_</span>) (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#from"><span class="id" title="variable">from</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>))) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#0f6d3b46a03d1336a5ac68936077dc02"><span class="id" title="notation">&gt;?</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Extras.html#isSome"><span class="id" title="definition">isSome</span></a> (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#from"><span class="id" title="variable">from</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Extras.html#isSome"><span class="id" title="definition">isSome</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#get_allowance_"><span class="id" title="variable">get_allowance_</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#from"><span class="id" title="variable">from</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>))<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Examples.BAT.html#get_allowance_"><span class="id" title="variable">get_allowance_</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#4bfb4f2d0721ba668e3a802ab1b745a1"><span class="id" title="notation">&lt;-&gt;</span></a> <a class="idref" href="ConCert.Execution.Extras.html#isSome"><span class="id" title="definition">isSome</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#transfer_from"><span class="id" title="definition">transfer_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>))) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">amount_zero</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a>, <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a>, <span class="id" title="var">get_allowance_</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">receive</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from_is_some"><span class="id" title="lemma">EIP20Token.try_transfer_from_is_some</span></a>, <a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab137"></a><h2 class="section">Approve correct</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_approve_allowance_correct"><span class="id" title="lemma">try_approve_allowance_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#approve"><span class="id" title="definition">approve</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#approve_allowance_update_correct"><span class="id" title="abbreviation">approve_allowance_update_correct</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>) <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a>) <a class="idref" href="ConCert.Execution.Examples.BAT.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_approve_allowance_correct"><span class="id" title="lemma">EIP20Token.try_approve_allowance_correct</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_approve_preserves_total_supply"><span class="id" title="lemma">try_approve_preserves_total_supply</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#approve"><span class="id" title="definition">approve</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_approve_preserves_total_supply"><span class="id" title="lemma">EIP20Token.try_approve_preserves_total_supply</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_approve_preserves_balances"><span class="id" title="lemma">try_approve_preserves_balances</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#approve"><span class="id" title="definition">approve</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_approve_preserves_balances"><span class="id" title="lemma">EIP20Token.try_approve_preserves_balances</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_approve_preserves_other_allowances"><span class="id" title="lemma">try_approve_preserves_other_allowances</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#approve"><span class="id" title="definition">approve</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">account</span>, <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_approve_preserves_other_allowances"><span class="id" title="lemma">EIP20Token.try_approve_preserves_other_allowances</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_approve_preserves_other_allowance"><span class="id" title="lemma">try_approve_preserves_other_allowance</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#approve"><span class="id" title="definition">approve</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">account</span>, <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#get_allowance"><span class="id" title="abbreviation">get_allowance</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>) (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>) <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#get_allowance"><span class="id" title="abbreviation">get_allowance</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>) (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>) <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_approve_preserves_other_allowance"><span class="id" title="lemma">EIP20Token.try_approve_preserves_other_allowance</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_approve_is_some"><span class="id" title="lemma">try_approve_is_some</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span>,<br/>
&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#0f6d3b46a03d1336a5ac68936077dc02"><span class="id" title="notation">&gt;?</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#4bfb4f2d0721ba668e3a802ab1b745a1"><span class="id" title="notation">&lt;-&gt;</span></a> <a class="idref" href="ConCert.Execution.Extras.html#isSome"><span class="id" title="definition">isSome</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#approve"><span class="id" title="definition">approve</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>))) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">receive</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_approve_is_some"><span class="id" title="lemma">EIP20Token.try_approve_is_some</span></a>, <a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab138"></a><h2 class="section">EIP20 functions only changes token_state</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="eip_only_changes_token_state"><span class="id" title="lemma">eip_only_changes_token_state</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">m</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenMsg"><span class="id" title="constructor">tokenMsg</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#m"><span class="id" title="variable">m</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">)|&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab139"></a><h2 class="section">EIP20 functions not payable</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="eip20_not_payable"><span class="id" title="lemma">eip20_not_payable</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">m</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenMsg"><span class="id" title="constructor">tokenMsg</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#m"><span class="id" title="variable">m</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#306329b0eca7a2b86c198702f594ad8e"><span class="id" title="notation">&lt;=</span></a> 0)%<span class="id" title="var">Z</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#EIP20_not_payable"><span class="id" title="lemma">EIP20Token.EIP20_not_payable</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab140"></a><h2 class="section">EIP20 functions produces no acts</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="eip20_new_acts_correct"><span class="id" title="lemma">eip20_new_acts_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">m</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenMsg"><span class="id" title="constructor">tokenMsg</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#m"><span class="id" title="variable">m</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#EIP20_no_acts"><span class="id" title="lemma">EIP20Token.EIP20_no_acts</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab141"></a><h2 class="section">Create_tokens correct</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_create_tokens_balance_correct"><span class="id" title="lemma">try_create_tokens_balance_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">-</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.to_N"><span class="id" title="definition">Z.to_N</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#add_is_partial_alter_plus"><span class="id" title="lemma">EIP20Token.add_is_partial_alter_plus</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <span class="id" title="var">ctx</span>) (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <span class="id" title="var">prev_state</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">from_balance</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">from_balance</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find_add"><span class="id" title="lemma">FMap.find_add</span></a>; <span class="id" title="var">cbn</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.add_sub"><span class="id" title="lemma">N.add_sub</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_create_tokens_total_supply_correct"><span class="id" title="lemma">try_create_tokens_total_supply_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.to_N"><span class="id" title="definition">Z.to_N</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_create_tokens_preserves_other_balances"><span class="id" title="lemma">try_create_tokens_preserves_other_balances</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">account</span>, <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span> <span class="id" title="var">account</span> <span class="id" title="var">account_not_sender</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#add_is_partial_alter_plus"><span class="id" title="lemma">EIP20Token.add_is_partial_alter_plus</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find_add_ne"><span class="id" title="lemma">FMap.find_add_ne</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_create_tokens_preserves_allowances"><span class="id" title="lemma">try_create_tokens_preserves_allowances</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_create_tokens_only_change_token_state"><span class="id" title="lemma">try_create_tokens_only_change_token_state</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">)|&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_create_tokens_is_some"><span class="id" title="lemma">try_create_tokens_is_some</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.lt"><span class="id" title="definition">Z.lt</span></a> 0 (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>)<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingStart"><span class="id" title="projection">fundingStart</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.to_N"><span class="id" title="definition">Z.to_N</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationCap"><span class="id" title="projection">tokenCreationCap</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#4bfb4f2d0721ba668e3a802ab1b745a1"><span class="id" title="notation">&lt;-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">x</span> <span class="id" title="var">y</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#x"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#y"><span class="id" title="variable">y</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_hyps</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">BoolElim</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_or_hyps</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_create_tokens_acts_correct"><span class="id" title="lemma">try_create_tokens_acts_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_create_tokens_amount_correct"><span class="id" title="lemma">try_create_tokens_amount_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.lt"><span class="id" title="definition">Z.lt</span></a> 0 <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.leb_gt"><span class="id" title="lemma">Z.leb_gt</span></a> <span class="id" title="tactic">in</span> *.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab142"></a><h2 class="section">Finalize correct</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_finalize_isFinalized_correct"><span class="id" title="lemma">try_finalize_isFinalized_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#finalize"><span class="id" title="constructor">finalize</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">BoolElim</span> <span class="id" title="tactic">in</span> *.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_finalize_only_change_isFinalized"><span class="id" title="lemma">try_finalize_only_change_isFinalized</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#finalize"><span class="id" title="constructor">finalize</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">)|&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_finalize_preserves_total_supply"><span class="id" title="lemma">try_finalize_preserves_total_supply</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#finalize"><span class="id" title="constructor">finalize</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_finalize_only_change_isFinalized"><span class="id" title="lemma">try_finalize_only_change_isFinalized</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">receive_some</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_finalize_is_some"><span class="id" title="lemma">try_finalize_is_some</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span>,<br/>
&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#0f6d3b46a03d1336a5ac68936077dc02"><span class="id" title="notation">&gt;?</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationCap"><span class="id" title="projection">tokenCreationCap</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#4bfb4f2d0721ba668e3a802ab1b745a1"><span class="id" title="notation">&lt;-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">x</span> <span class="id" title="var">y</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#finalize"><span class="id" title="constructor">finalize</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#x"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#y"><span class="id" title="variable">y</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_hyps</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">BoolElim</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_or_hyps</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">destruct_address_eq</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_finalize_acts_correct"><span class="id" title="lemma">try_finalize_acts_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#finalize"><span class="id" title="constructor">finalize</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#act_transfer"><span class="id" title="constructor">act_transfer</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_contract_balance"><span class="id" title="projection">ctx_contract_balance</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab143"></a><h2 class="section">Refund correct</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_refund_balance_correct"><span class="id" title="lemma">try_refund_balance_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find_add"><span class="id" title="lemma">FMap.find_add</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_refund_total_supply_correct"><span class="id" title="lemma">try_refund_total_supply_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">-</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>))<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_refund_preserves_other_balances"><span class="id" title="lemma">try_refund_preserves_other_balances</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">account</span>, <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span> <span class="id" title="var">account</span> <span class="id" title="var">account_not_sender</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find_add_ne"><span class="id" title="lemma">FMap.find_add_ne</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_refund_preserves_allowances"><span class="id" title="lemma">try_refund_preserves_allowances</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_refund_only_change_token_state"><span class="id" title="lemma">try_refund_only_change_token_state</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#token_state"><span class="id" title="projection">token_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">)|&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_refund_is_some"><span class="id" title="lemma">try_refund_is_some</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span>,<br/>
&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#0f6d3b46a03d1336a5ac68936077dc02"><span class="id" title="notation">&gt;?</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#f0f4688c5a02589da6dbdaffc379b3bb"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#f0f4688c5a02589da6dbdaffc379b3bb"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#f0f4688c5a02589da6dbdaffc379b3bb"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#f0f4688c5a02589da6dbdaffc379b3bb"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#f0f4688c5a02589da6dbdaffc379b3bb"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#f0f4688c5a02589da6dbdaffc379b3bb"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#4bfb4f2d0721ba668e3a802ab1b745a1"><span class="id" title="notation">&lt;-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">x</span> <span class="id" title="var">y</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#x"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#y"><span class="id" title="variable">y</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_hyps</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">BoolElim</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_or_hyps</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">destruct_address_eq</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_refund_acts_correct"><span class="id" title="lemma">try_refund_acts_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#act_transfer"><span class="id" title="constructor">act_transfer</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.of_N"><span class="id" title="definition">Z.of_N</span></a> (<a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#be3f246709fdc565d9577f86645e6da3"><span class="id" title="notation">/</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#be3f246709fdc565d9577f86645e6da3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#be3f246709fdc565d9577f86645e6da3"><span class="id" title="notation">)</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">]</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab144"></a><h2 class="section">Init correct</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="init_bat_balance_correct"><span class="id" title="lemma">init_bat_balance_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">setup</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#init"><span class="id" title="definition">init</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a>) (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_batFund"><span class="id" title="projection">_batFund</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find_add"><span class="id" title="lemma">FMap.find_add</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="init_other_balances_correct"><span class="id" title="lemma">init_other_balances_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">setup</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#init"><span class="id" title="definition">init</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">account</span>, <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">init_some</span> <span class="id" title="var">account</span> <span class="id" title="var">account_not_funddeposit</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.find_add_ne"><span class="id" title="lemma">FMap.find_add_ne</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="init_allowances_correct"><span class="id" title="lemma">init_allowances_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">setup</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#init"><span class="id" title="definition">init</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#allowances"><span class="id" title="definition">allowances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Containers.html#FMap.empty"><span class="id" title="abbreviation">FMap.empty</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="init_isFinalized_correct"><span class="id" title="lemma">init_isFinalized_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">setup</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#init"><span class="id" title="definition">init</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="init_total_supply_correct"><span class="id" title="lemma">init_total_supply_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">setup</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#init"><span class="id" title="definition">init</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_batFund"><span class="id" title="projection">_batFund</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="init_constants_correct"><span class="id" title="lemma">init_constants_correct</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">setup</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#init"><span class="id" title="definition">init</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_fundDeposit"><span class="id" title="projection">_fundDeposit</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_batFundDeposit"><span class="id" title="projection">_batFundDeposit</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingStart"><span class="id" title="projection">fundingStart</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_fundingStart"><span class="id" title="projection">_fundingStart</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_fundingEnd"><span class="id" title="projection">_fundingEnd</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_tokenExchangeRate"><span class="id" title="projection">_tokenExchangeRate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationCap"><span class="id" title="projection">tokenCreationCap</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_tokenCreationCap"><span class="id" title="projection">_tokenCreationCap</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_tokenCreationMin"><span class="id" title="projection">_tokenCreationMin</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#initSupply"><span class="id" title="projection">initSupply</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_batFund"><span class="id" title="projection">_batFund</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab145"></a><h2 class="section">Functions preserve sum of balances</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_preserves_balances_sum"><span class="id" title="lemma">try_transfer_preserves_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#transfer"><span class="id" title="definition">transfer</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#1a7c813b94b558ea019b505527ec0f3c"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#1a7c813b94b558ea019b505527ec0f3c"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_preserves_balances_sum"><span class="id" title="lemma">EIP20Token.try_transfer_preserves_balances_sum</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_transfer_from_preserves_balances_sum"><span class="id" title="lemma">try_transfer_from_preserves_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">from</span> <span class="id" title="var">to</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#transfer_from"><span class="id" title="definition">transfer_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#from"><span class="id" title="variable">from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#to"><span class="id" title="variable">to</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#1a7c813b94b558ea019b505527ec0f3c"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#1a7c813b94b558ea019b505527ec0f3c"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_transfer_from_preserves_balances_sum"><span class="id" title="lemma">EIP20Token.try_transfer_from_preserves_balances_sum</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_approve_preserves_balances_sum"><span class="id" title="lemma">try_approve_preserves_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">delegate</span> <span class="id" title="var">amount</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#approve"><span class="id" title="definition">approve</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#delegate"><span class="id" title="variable">delegate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#amount"><span class="id" title="variable">amount</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#1a7c813b94b558ea019b505527ec0f3c"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#1a7c813b94b558ea019b505527ec0f3c"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#try_approve_preserves_balances_sum"><span class="id" title="lemma">EIP20Token.try_approve_preserves_balances_sum</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_create_tokens_update_balances_sum"><span class="id" title="lemma">try_create_tokens_update_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_tokens"><span class="id" title="constructor">create_tokens</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#1a7c813b94b558ea019b505527ec0f3c"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.to_N"><span class="id" title="definition">Z.to_N</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_amount"><span class="id" title="projection">ctx_amount</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#1a7c813b94b558ea019b505527ec0f3c"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sum_balances"><span class="id" title="definition">EIP20Token.sum_balances</span></a>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#add_is_partial_alter_plus"><span class="id" title="lemma">EIP20Token.add_is_partial_alter_plus</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <span class="id" title="var">ctx</span>) (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <span class="id" title="var">prev_state</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">from_balance</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">from_balance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.elements_add_existing"><span class="id" title="lemma">FMap.elements_add_existing</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <a class="idref" href="ConCert.Execution.Extras.html#sumN_split"><span class="id" title="lemma">sumN_split</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">x</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <span class="id" title="var">ctx</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) (<span class="id" title="var">y</span>:= <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <span class="id" title="var">ctx</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Execution.Extras.html#sumN_swap"><span class="id" title="lemma">sumN_swap</span></a>, <span class="id" title="lemma">fin_maps.map_to_list_delete</span>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.add_comm"><span class="id" title="lemma">N.add_comm</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">from_balance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.elements_add"><span class="id" title="lemma">FMap.elements_add</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.add_comm"><span class="id" title="lemma">N.add_comm</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_finalize_preserves_balances_sum"><span class="id" title="lemma">try_finalize_preserves_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#finalize"><span class="id" title="constructor">finalize</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#1a7c813b94b558ea019b505527ec0f3c"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#1a7c813b94b558ea019b505527ec0f3c"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="try_refund_update_balances_sum"><span class="id" title="lemma">try_refund_update_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#1a7c813b94b558ea019b505527ec0f3c"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#1a7c813b94b558ea019b505527ec0f3c"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a>) (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>))<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sum_balances"><span class="id" title="definition">EIP20Token.sum_balances</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.elements_add_existing"><span class="id" title="lemma">FMap.elements_add_existing</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">change</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span> ((<span class="id" title="keyword">fun</span> '<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><span class="id" title="var">_</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">v</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> =&gt; <a class="idref" href="ConCert.Execution.Examples.BAT.html#v"><span class="id" title="variable">v</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#ctx_from"><span class="id" title="projection">ctx_from</span></a> <span class="id" title="var">ctx</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <span class="id" title="var">n</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Execution.Extras.html#sumN_inv"><span class="id" title="lemma">sumN_inv</span></a>, <a class="idref" href="ConCert.Execution.Extras.html#sumN_swap"><span class="id" title="lemma">sumN_swap</span></a>, <span class="id" title="lemma">fin_maps.map_to_list_delete</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="init_preserves_balances_sum"><span class="id" title="lemma">init_preserves_balances_sum</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">setup</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#init"><span class="id" title="definition">init</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#1a7c813b94b558ea019b505527ec0f3c"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#state"><span class="id" title="variable">state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.EIP20Token.html#sum_balances"><span class="id" title="definition">EIP20Token.sum_balances</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Containers.html#FMap.elements_add"><span class="id" title="lemma">FMap.elements_add</span></a>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">fin_maps.map_to_list_empty</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.add_0_r"><span class="id" title="lemma">N.add_0_r</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab146"></a><h2 class="section">Sum of balances always equals total supply</h2>

<div class="paragraph"> </div>

 In any reachable state the sum of token balance
    will be equal to the total supply of tokens 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="sum_balances_eq_total_supply"><span class="id" title="lemma">sum_balances_eq_total_supply</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span> :<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#contract"><span class="id" title="definition">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#contract_state"><span class="id" title="definition">contract_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#1a7c813b94b558ea019b505527ec0f3c"><span class="id" title="notation">sum_balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#lift_contract_state_prop"><span class="id" title="lemma">lift_contract_state_prop</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#contract"><span class="id" title="definition">contract</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> *; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">reach</span> <span class="id" title="var">deployed</span> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#init_preserves_balances_sum"><span class="id" title="lemma">init_preserves_balances_sum</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">IH</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_message</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> &lt;- <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_transfer_preserves_balances_sum"><span class="id" title="lemma">try_transfer_preserves_balances_sum</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_transfer_preserves_total_supply"><span class="id" title="lemma">try_transfer_preserves_total_supply</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> &lt;- <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_transfer_from_preserves_balances_sum"><span class="id" title="lemma">try_transfer_from_preserves_balances_sum</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_transfer_from_preserves_total_supply"><span class="id" title="lemma">try_transfer_from_preserves_total_supply</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> &lt;- <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_approve_preserves_balances_sum"><span class="id" title="lemma">try_approve_preserves_balances_sum</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_approve_preserves_total_supply"><span class="id" title="lemma">try_approve_preserves_total_supply</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> &lt;- <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_create_tokens_update_balances_sum"><span class="id" title="lemma">try_create_tokens_update_balances_sum</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_create_tokens_total_supply_correct"><span class="id" title="lemma">try_create_tokens_total_supply_correct</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> &lt;- <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_finalize_preserves_balances_sum"><span class="id" title="lemma">try_finalize_preserves_balances_sum</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;- <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_finalize_preserves_total_supply"><span class="id" title="lemma">try_finalize_preserves_total_supply</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_refund_update_balances_sum"><span class="id" title="lemma">try_refund_update_balances_sum</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> <span class="id" title="var">balance_sum</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_refund_total_supply_correct"><span class="id" title="lemma">try_refund_total_supply_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab147"></a><h2 class="section">Total supply can only grow before funding fails</h2>

<div class="paragraph"> </div>

 If funding period is active or funding goal was hit then the
    total supply of tokens cannot decrease 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="receive_total_supply_increasing"><span class="id" title="lemma">receive_total_supply_increasing</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">msg</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#f031fe1957c4a4a8e217aa46af2b4e25"><span class="id" title="notation">\/</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#msg"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">funding_active</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_message</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_transfer_preserves_total_supply"><span class="id" title="lemma">try_transfer_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_transfer_from_preserves_total_supply"><span class="id" title="lemma">try_transfer_from_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_approve_preserves_total_supply"><span class="id" title="lemma">try_approve_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_create_tokens_total_supply_correct"><span class="id" title="lemma">try_create_tokens_total_supply_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">receive_some</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_add_r"><span class="id" title="lemma">N.le_add_r</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_finalize_preserves_total_supply"><span class="id" title="lemma">try_finalize_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">specialize</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_refund_is_some"><span class="id" title="lemma">try_refund_is_some</span></a> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">refund_implications</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">receive_some</span> <span class="id" title="tactic">in</span> <span class="id" title="var">refund_implications</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">refund_implications</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab148"></a><h2 class="section">Constants are constant</h2>

<div class="paragraph"> </div>

 Constants should never change after after receiving msg 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="receive_preserves_constants"><span class="id" title="lemma">receive_preserves_constants</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">msg</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#msg"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingStart"><span class="id" title="projection">fundingStart</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingStart"><span class="id" title="projection">fundingStart</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationCap"><span class="id" title="projection">tokenCreationCap</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationCap"><span class="id" title="projection">tokenCreationCap</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#initSupply"><span class="id" title="projection">initSupply</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#initSupply"><span class="id" title="projection">initSupply</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_message</span>; <span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Constants are always equal to the initial assignment 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="constants_are_constant"><span class="id" title="lemma">constants_are_constant</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span> (<span class="id" title="var">trace</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#ChainTrace"><span class="id" title="definition">ChainTrace</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#empty_state"><span class="id" title="definition">empty_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a>) :<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#contract"><span class="id" title="definition">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">deploy_info</span> <span class="id" title="var">cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#deployment_info"><span class="id" title="definition">deployment_info</span></a> <span class="id" title="var">_</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#trace"><span class="id" title="variable">trace</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deploy_info"><span class="id" title="variable">deploy_info</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#contract_state"><span class="id" title="definition">contract_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <span class="id" title="keyword">let</span> <span class="id" title="var">setup</span> := <a class="idref" href="ConCert.Execution.Examples.BAT.html#deploy_info"><span class="id" title="variable">deploy_info</span></a>.(<a class="idref" href="ConCert.Execution.Blockchain.html#deployment_setup"><span class="id" title="projection">deployment_setup</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_fundDeposit"><span class="id" title="projection">_fundDeposit</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_batFundDeposit"><span class="id" title="projection">_batFundDeposit</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingStart"><span class="id" title="projection">fundingStart</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_fundingStart"><span class="id" title="projection">_fundingStart</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_fundingEnd"><span class="id" title="projection">_fundingEnd</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_tokenExchangeRate"><span class="id" title="projection">_tokenExchangeRate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationCap"><span class="id" title="projection">tokenCreationCap</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_tokenCreationCap"><span class="id" title="projection">_tokenCreationCap</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_tokenCreationMin"><span class="id" title="projection">_tokenCreationMin</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#initSupply"><span class="id" title="projection">initSupply</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_batFund"><span class="id" title="projection">_batFund</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#lift_dep_info_contract_state_prop"><span class="id" title="lemma">lift_dep_info_contract_state_prop</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#contract"><span class="id" title="definition">contract</span></a>); <span class="id" title="tactic">intros</span> *.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#init_constants_correct"><span class="id" title="lemma">init_constants_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">IH</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#receive_preserves_constants"><span class="id" title="lemma">receive_preserves_constants</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab149"></a><h2 class="section">Finalize cannot be undone</h2>

<div class="paragraph"> </div>

 Once the contract is in the finalized state it cannot leave it 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="final_is_final"><span class="id" title="lemma">final_is_final</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">new_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">msg</span> <span class="id" title="var">new_acts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#receive"><span class="id" title="definition">receive</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#chain"><span class="id" title="variable">chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#ctx"><span class="id" title="variable">ctx</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#prev_state"><span class="id" title="variable">prev_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#msg"><span class="id" title="variable">msg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_state"><span class="id" title="variable">new_state</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * (<span class="id" title="var">finalized</span> &amp; <span class="id" title="var">receive_some</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">destruct_message</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- (<a class="idref" href="ConCert.Execution.Examples.BAT.html#eip_only_changes_token_state"><span class="id" title="lemma">eip_only_changes_token_state</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">receive_some</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- (<a class="idref" href="ConCert.Execution.Examples.BAT.html#try_create_tokens_only_change_token_state"><span class="id" title="lemma">try_create_tokens_only_change_token_state</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">receive_some</span>).<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_finalize_isFinalized_correct"><span class="id" title="lemma">try_finalize_isFinalized_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- (<a class="idref" href="ConCert.Execution.Examples.BAT.html#try_refund_only_change_token_state"><span class="id" title="lemma">try_refund_only_change_token_state</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">receive_some</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab150"></a><h2 class="section">Cannot finalize if goal not hit</h2>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="no_finalization_before_goal"><span class="id" title="lemma">no_finalization_before_goal</span></a> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span> :<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#contract"><span class="id" title="definition">contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#contract_state"><span class="id" title="definition">contract_state</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#f0f4688c5a02589da6dbdaffc379b3bb"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#lift_contract_state_prop"><span class="id" title="lemma">lift_contract_state_prop</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#contract"><span class="id" title="definition">contract</span></a>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> *; <span class="id" title="tactic">auto</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">reach</span> <span class="id" title="var">deployed</span> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> ? <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#init_isFinalized_correct"><span class="id" title="lemma">init_isFinalized_correct</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">IH</span> <span class="id" title="var">receive_some</span> ?.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_message</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#eip_only_changes_token_state"><span class="id" title="lemma">eip_only_changes_token_state</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> <span class="id" title="var">finalized_unchanged</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_transfer_preserves_total_supply"><span class="id" title="lemma">try_transfer_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> <span class="id" title="var">supply_unchanged</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">supply_unchanged</span>, &lt;- <span class="id" title="var">finalized_unchanged</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_transfer_from_preserves_total_supply"><span class="id" title="lemma">try_transfer_from_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> <span class="id" title="var">supply_unchanged</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">supply_unchanged</span>, &lt;- <span class="id" title="var">finalized_unchanged</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_approve_preserves_total_supply"><span class="id" title="lemma">try_approve_preserves_total_supply</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> <span class="id" title="var">supply_unchanged</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">supply_unchanged</span>, &lt;- <span class="id" title="var">finalized_unchanged</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">BoolElim</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">BoolElim</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.nlt_ge"><span class="id" title="lemma">N.nlt_ge</span></a> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">autorewrite</span> <span class="id" title="keyword">with</span> <span class="id" title="var">BoolElim</span> <span class="id" title="tactic">in</span> *.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab151"></a><h2 class="section">It is always possible to finalize</h2>

<div class="paragraph"> </div>

 Prove that it is always possible to reach a state where the token is finalized if the funding
    goal was reached 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="can_finalize_if_creation_min"><span class="id" title="lemma">can_finalize_if_creation_min</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">bstate</span> (<span class="id" title="var">reward</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a>) (<span class="id" title="var">caddr</span> <span class="id" title="var">creator</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>),<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#creator"><span class="id" title="variable">creator</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Examples.BAT.html#reward"><span class="id" title="variable">reward</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#b1f0780291abe9bd18804d2c9a5039d4"><span class="id" title="notation">&gt;=</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#emptyable"><span class="id" title="definition">emptyable</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#serializeState"><span class="id" title="definition">serializeState</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">bstate'</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate'"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#emptyable"><span class="id" title="definition">emptyable</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate'"><span class="id" title="variable">bstate'</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">cstate'</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate'"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate'"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#serializeState"><span class="id" title="definition">serializeState</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate'"><span class="id" title="variable">cstate'</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate'"><span class="id" title="variable">cstate'</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">Hcreator</span> <span class="id" title="var">Hreward</span> <span class="id" title="var">bstate_reachable</span> <span class="id" title="var">bstate_queue</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Empty&nbsp;the&nbsp;action&nbsp;queue&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;add&nbsp;new&nbsp;blocks&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">empty_queue</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">cstate</span> &amp; <span class="id" title="var">contract_deployed</span> &amp; <span class="id" title="var">contract_state</span> &amp; <span class="id" title="var">creation_min</span> &amp; <span class="id" title="var">fund_deposit_not_contract</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;H&nbsp;is&nbsp;preserved&nbsp;after&nbsp;transfers,&nbsp;discarding&nbsp;invalid&nbsp;actions,&nbsp;calling&nbsp;other&nbsp;contracts&nbsp;and&nbsp;deploying&nbsp;contracts&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only</span> 3: <span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqdec"><span class="id" title="method">address_eqdec</span></a> <span class="id" title="var">caddr</span> <span class="id" title="var">to_addr</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">now</span> <span class="id" title="tactic">eexists</span>; <span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>).<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;H&nbsp;is&nbsp;preserved&nbsp;after&nbsp;calls&nbsp;to&nbsp;the&nbsp;contract&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">amount_nonnegative</span> <span class="id" title="var">enough_balance</span> <span class="id" title="var">reward</span> <span class="id" title="var">Hreward</span> <span class="id" title="var">creator</span> <span class="id" title="var">Hcreator</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">bstate_queue</span> <span class="id" title="var">bstate_reachable</span> <span class="id" title="var">bstate</span> <span class="id" title="var">new_acts_eq</span> <span class="id" title="var">act_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">contract_deployed</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deployed</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">contract_state</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deployed_state</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">deployed_state</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#wc_receive_strong"><span class="id" title="lemma">wc_receive_strong</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">prev_state'</span> &amp; <span class="id" title="var">msg'</span> &amp; <span class="id" title="var">new_state'</span> &amp; <span class="id" title="var">serialize_prev_state</span> &amp; <span class="id" title="var">_</span> &amp; <span class="id" title="var">serialize_new_state</span> &amp; <span class="id" title="var">receive_some</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Serializable.html#deserialize_serialize"><span class="id" title="method">deserialize_serialize</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">serialize_prev_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">serialize_prev_state</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">serialize_prev_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#receive_total_supply_increasing"><span class="id" title="lemma">receive_total_supply_increasing</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> <span class="id" title="var">total_supply_increasing</span>; <span class="id" title="tactic">try</span> (<span class="id" title="var">cbn</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#receive_preserves_constants"><span class="id" title="lemma">receive_preserves_constants</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> (? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span> : <span class="id" title="var">_</span> <span class="id" title="var">prev_state'</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a>  <span class="id" title="var">_</span> <span class="id" title="var">new_state'</span> |- <span class="id" title="var">_</span>=&gt; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">new_state'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="var">update_all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;First&nbsp;check&nbsp;if&nbsp;contract&nbsp;is&nbsp;already&nbsp;finalized,&nbsp;if&nbsp;it&nbsp;is&nbsp;we&nbsp;just&nbsp;use&nbsp;the&nbsp;current&nbsp;state&nbsp;to&nbsp;finish&nbsp;proof&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <span class="id" title="var">cstate</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">finalized</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#empty_queue_is_emptyable"><span class="id" title="lemma">empty_queue_is_emptyable</span></a> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Fast&nbsp;forward&nbsp;time/slot&nbsp;to&nbsp;"fundingEnd"&nbsp;so&nbsp;that&nbsp;we&nbsp;know&nbsp;for&nbsp;sure&nbsp;that&nbsp;the&nbsp;funding&nbsp;period&nbsp;is&nbsp;not&nbsp;active<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;the&nbsp;next&nbsp;block&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">forward_time</span> (<span class="id" title="var">cstate</span>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a>)); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;forward_time&nbsp;gives&nbsp;us&nbsp;a&nbsp;new&nbsp;ChainState&nbsp;so&nbsp;we&nbsp;no&nbsp;longer&nbsp;need&nbsp;the&nbsp;old&nbsp;one&nbsp;therefore<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;call&nbsp;update_all&nbsp;to&nbsp;replace&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;the&nbsp;old&nbsp;ChainState&nbsp;with&nbsp;the&nbsp;new&nbsp;one&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;know&nbsp;that&nbsp;the&nbsp;funding&nbsp;period&nbsp;is&nbsp;over&nbsp;or&nbsp;on&nbsp;its&nbsp;last&nbsp;slot&nbsp;and&nbsp;the&nbsp;funding&nbsp;minimum&nbsp;has&nbsp;been&nbsp;hit.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;So&nbsp;now&nbsp;we&nbsp;can&nbsp;add&nbsp;a&nbsp;new&nbsp;block&nbsp;containing&nbsp;a&nbsp;finalize&nbsp;call&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add_block</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#finalize_act"><span class="id" title="definition">finalize_act</span></a> <span class="id" title="var">cstate</span> <span class="id" title="var">caddr</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">)]</span></a> 1%<span class="id" title="var">nat</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">list.Forall_singleton</span>, <a class="idref" href="ConCert.Execution.Blockchain.html#address_eq_refl"><span class="id" title="lemma">address_eq_refl</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;hypothesis&nbsp;"slot_hit"&nbsp;no&nbsp;longer&nbsp;holds&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;update&nbsp;it&nbsp;manually&nbsp;before&nbsp;calling&nbsp;update_all&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a> <span class="id" title="var">cstate</span>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <span class="id" title="var">bstate0</span>)%<span class="id" title="var">nat</span> <span class="id" title="tactic">in</span> <span class="id" title="var">slot_hit</span> <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">easy</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">reward</span> <span class="id" title="var">Hreward</span> <span class="id" title="var">creator</span> <span class="id" title="var">Hcreator</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;can&nbsp;now&nbsp;evaluate&nbsp;the&nbsp;action&nbsp;we&nbsp;added&nbsp;giving&nbsp;us&nbsp;a&nbsp;ChainState&nbsp;where<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;token&nbsp;is&nbsp;in&nbsp;its&nbsp;finalized&nbsp;state&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">evaluate_action</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;there&nbsp;is&nbsp;enough&nbsp;balance&nbsp;to&nbsp;evaluate&nbsp;action&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#account_balance_nonnegative"><span class="id" title="lemma">account_balance_nonnegative</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;receive&nbsp;action&nbsp;returns&nbsp;Some&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#try_finalize_is_some"><span class="id" title="lemma">try_finalize_is_some</span></a> <span class="id" title="var">cstate</span> <span class="id" title="var">bstate0</span>) <span class="id" title="keyword">as</span> ((<span class="id" title="var">new_cstate</span> &amp; <span class="id" title="var">new_act</span> &amp; <span class="id" title="var">receive_some</span>) &amp; <span class="id" title="var">_</span>); <span class="id" title="var">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">specialize</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_finalize_isFinalized_correct"><span class="id" title="lemma">try_finalize_isFinalized_correct</span></a> <span class="id" title="keyword">as</span> [<span class="id" title="var">_</span> <span class="id" title="var">finalized_new_cstate</span>]; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="var">erewrite</span> &lt;- (<a class="idref" href="ConCert.Execution.Examples.BAT.html#try_finalize_only_change_isFinalized"><span class="id" title="lemma">try_finalize_only_change_isFinalized</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">receive_some</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">finalized_new_cstate</span>, (<a class="idref" href="ConCert.Execution.Examples.BAT.html#try_finalize_acts_correct"><span class="id" title="lemma">try_finalize_acts_correct</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">receive_some</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">contract_state</span> <span class="id" title="var">slot_hit</span> <span class="id" title="var">creation_min</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_all</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue0</span>; <span class="id" title="tactic">do</span> 3 <span class="id" title="tactic">f_equal</span>;<span class="id" title="tactic">repeat</span> (<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>)|].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Finally&nbsp;we&nbsp;need&nbsp;to&nbsp;evaluate&nbsp;the&nbsp;new&nbsp;transfer&nbsp;action&nbsp;that&nbsp;finalize&nbsp;produced&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">evaluate_transfer</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;the&nbsp;transfer&nbsp;is&nbsp;nonnegative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.add_0_r"><span class="id" title="lemma">Z.add_0_r</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#account_balance_nonnegative"><span class="id" title="lemma">account_balance_nonnegative</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;there&nbsp;is&nbsp;enough&nbsp;balance&nbsp;to&nbsp;evaluate&nbsp;the&nbsp;transfer&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.add_0_r"><span class="id" title="lemma">Z.add_0_r</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.le_ge"><span class="id" title="lemma">Z.le_ge</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.le_refl"><span class="id" title="lemma">Z.le_refl</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">exists</span> <span class="id" title="var">bstate0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#empty_queue_is_emptyable"><span class="id" title="lemma">empty_queue_is_emptyable</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> (<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="tactic">eauto</span>).<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Prove that it is always possible to reach a state where the token is finalized if there
    is enough money in the blockchain and the contract constants have valid values 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="can_finalize_if_deployed"><span class="id" title="lemma">can_finalize_if_deployed</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">deployed_bstate</span> (<span class="id" title="var">reward</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a>) (<span class="id" title="var">caddr</span> <span class="id" title="var">creator</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>) <span class="id" title="var">accounts</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#creator"><span class="id" title="variable">creator</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Examples.BAT.html#reward"><span class="id" title="variable">reward</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#b1f0780291abe9bd18804d2c9a5039d4"><span class="id" title="notation">&gt;=</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_bstate"><span class="id" title="variable">deployed_bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#emptyable"><span class="id" title="definition">emptyable</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_bstate"><span class="id" title="variable">deployed_bstate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#NoDup"><span class="id" title="inductive">NoDup</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#accounts"><span class="id" title="variable">accounts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">acc</span> =&gt; <a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#acc"><span class="id" title="variable">acc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>) <a class="idref" href="ConCert.Execution.Examples.BAT.html#accounts"><span class="id" title="variable">accounts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">deployed_cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_bstate"><span class="id" title="variable">deployed_bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_bstate"><span class="id" title="variable">deployed_bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#serializeState"><span class="id" title="definition">serializeState</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_cstate"><span class="id" title="variable">deployed_cstate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">((</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_cstate"><span class="id" title="variable">deployed_cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">-</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_cstate"><span class="id" title="variable">deployed_cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">))</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.to_N"><span class="id" title="definition">Z.to_N</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#spendable_balance"><span class="id" title="definition">spendable_balance</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_bstate"><span class="id" title="variable">deployed_bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#accounts"><span class="id" title="variable">accounts</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_cstate"><span class="id" title="variable">deployed_cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_cstate"><span class="id" title="variable">deployed_cstate</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_cstate"><span class="id" title="variable">deployed_cstate</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationCap"><span class="id" title="projection">tokenCreationCap</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">-</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_cstate"><span class="id" title="variable">deployed_cstate</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingStart"><span class="id" title="projection">fundingStart</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_cstate"><span class="id" title="variable">deployed_cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#env_chain"><span class="id" title="projection">env_chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_bstate"><span class="id" title="variable">deployed_bstate</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#env_chain"><span class="id" title="projection">env_chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_bstate"><span class="id" title="variable">deployed_bstate</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_cstate"><span class="id" title="variable">deployed_cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundDeposit"><span class="id" title="projection">fundDeposit</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_cstate"><span class="id" title="variable">deployed_cstate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_cstate"><span class="id" title="variable">deployed_cstate</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> 0<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">bstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#deployed_bstate"><span class="id" title="variable">deployed_bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#emptyable"><span class="id" title="definition">emptyable</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#serializeState"><span class="id" title="definition">serializeState</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">Hcreator</span> <span class="id" title="var">Hreward</span> <span class="id" title="var">reach'</span> <span class="id" title="var">empty</span> <span class="id" title="var">accounts_unique</span> <span class="id" title="var">accounts_not_contracts</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Empty&nbsp;the&nbsp;action&nbsp;queue&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;add&nbsp;new&nbsp;blocks&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">empty_queue</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">cstate</span> &amp; <span class="id" title="var">contract_deployed</span> &amp; <span class="id" title="var">contract_state</span> &amp; <span class="id" title="var">enough_balance_to_fund</span> &amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">can_hit_fund_min</span> &amp; <span class="id" title="var">funding_period_started</span> &amp; <span class="id" title="var">funding_period_not_over</span> &amp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fund_deposit_not_contract</span> &amp; <span class="id" title="var">echange_rate_nonzero</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;H&nbsp;is&nbsp;preserved&nbsp;after&nbsp;transfers,&nbsp;discarding&nbsp;invalid&nbsp;actions,&nbsp;calling&nbsp;other&nbsp;contracts&nbsp;and&nbsp;deploying&nbsp;contracts&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only</span> 3: <span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#address_eqdec"><span class="id" title="method">address_eqdec</span></a> <span class="id" title="var">caddr</span> <span class="id" title="var">to_addr</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">exists</span> <span class="id" title="var">cstate</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; (<span class="id" title="var">easy</span> || <span class="id" title="var">now</span> <span class="id" title="var">destruct_address_eq</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">enough_balance_to_fund</span> | <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.mul_le_mono_r"><span class="id" title="lemma">N.mul_le_mono_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.Znat.html#Z2N.inj_le"><span class="id" title="lemma">Z2N.inj_le</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#spendable_balance_positive"><span class="id" title="lemma">spendable_balance_positive</span></a>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#spendable_consume_act"><span class="id" title="lemma">spendable_consume_act</span></a>; <span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="tactic">subst</span>; (<span class="id" title="tactic">try</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;H&nbsp;is&nbsp;preserved&nbsp;after&nbsp;calls&nbsp;to&nbsp;the&nbsp;contract&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">enough_balance</span> <span class="id" title="var">reward</span> <span class="id" title="var">Hreward</span> <span class="id" title="var">creator</span> <span class="id" title="var">Hcreator</span> <span class="id" title="var">empty</span> <span class="id" title="var">reach'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">deployed_bstate</span> <span class="id" title="var">new_acts_eq</span> <span class="id" title="var">accounts_unique</span> <span class="id" title="var">accounts_not_contracts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">contract_deployed</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">contract_state</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deployed_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">deployed_state</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#wc_receive_strong"><span class="id" title="lemma">wc_receive_strong</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">prev_state'</span> &amp; <span class="id" title="var">msg'</span> &amp; <span class="id" title="var">new_state'</span> &amp; <span class="id" title="var">serialize_prev_state</span> &amp; <span class="id" title="var">serialize_msg</span> &amp; <span class="id" title="var">serialize_new_state</span> &amp; <span class="id" title="var">receive_some</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Serializable.html#deserialize_serialize"><span class="id" title="method">deserialize_serialize</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">serialize_prev_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">serialize_prev_state</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">serialize_prev_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#receive_total_supply_increasing"><span class="id" title="lemma">receive_total_supply_increasing</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> <span class="id" title="var">total_supply_increasing</span>; <span class="id" title="tactic">try</span> (<span class="id" title="var">cbn</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#receive_preserves_constants"><span class="id" title="lemma">receive_preserves_constants</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span> (? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ?).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span> : <span class="id" title="var">_</span> <span class="id" title="var">prev_state'</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a>  <span class="id" title="var">_</span> <span class="id" title="var">new_state'</span> |- <span class="id" title="var">_</span>=&gt; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexists</span> <span class="id" title="var">new_state'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; (<span class="id" title="var">easy</span> || <span class="id" title="var">now</span> <span class="id" title="var">destruct_address_eq</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span>; [| <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.sub_le_mono_l"><span class="id" title="lemma">N.sub_le_mono_l</span></a>, <span class="id" title="var">total_supply_increasing</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">enough_balance_to_fund</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.mul_le_mono_r"><span class="id" title="lemma">N.mul_le_mono_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.Znat.html#Z2N.inj_le"><span class="id" title="lemma">Z2N.inj_le</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#spendable_balance_positive"><span class="id" title="lemma">spendable_balance_positive</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#spendable_consume_act"><span class="id" title="lemma">spendable_consume_act</span></a>; <span class="id" title="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Update&nbsp;goal&nbsp;and&nbsp;eleminate&nbsp;all&nbsp;occurrences&nbsp;of&nbsp;old&nbsp;ChainState&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;that&nbsp;the&nbsp;queue&nbsp;is&nbsp;empty&nbsp;we&nbsp;can&nbsp;switch&nbsp;from&nbsp;using&nbsp;spendable_balance<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;total_balance&nbsp;to&nbsp;simplify&nbsp;the&nbsp;proof&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#spendable_eq_total_balance"><span class="id" title="lemma">spendable_eq_total_balance</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span>; <span class="id" title="tactic">eauto</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;First&nbsp;check&nbsp;if&nbsp;contract&nbsp;is&nbsp;already&nbsp;finalized,&nbsp;if&nbsp;it&nbsp;is&nbsp;we&nbsp;just&nbsp;use&nbsp;the&nbsp;current&nbsp;state&nbsp;to&nbsp;finish&nbsp;proof&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <span class="id" title="var">cstate</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">finalized</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">eexists</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>; <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#empty_queue_is_emptyable"><span class="id" title="lemma">empty_queue_is_emptyable</span></a> |].<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Next&nbsp;add&nbsp;a&nbsp;new&nbsp;block&nbsp;containing&nbsp;enough&nbsp;create_tokens&nbsp;actions&nbsp;to&nbsp;reach&nbsp;funding&nbsp;goal&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">add_block</span> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_token_acts"><span class="id" title="definition">create_token_acts</span></a> (<span class="id" title="var">bstate</span><a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">&lt;|</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">:=</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#add_balance"><span class="id" title="definition">add_balance</span></a> <span class="id" title="var">creator</span> <span class="id" title="var">reward</span> <span class="id" title="var">bstate</span>.(<a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a>)<a class="idref" href="ConCert.Utils.RecordSet.html#f46003504e2d2076ab5611d27918b097"><span class="id" title="notation">|&gt;</span></a>) <span class="id" title="var">caddr</span> <span class="id" title="var">accounts</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <span class="id" title="var">cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">-</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <span class="id" title="var">cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">)</span></a>) <span class="id" title="var">cstate</span>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a>)) 1%<span class="id" title="var">nat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only</span> 1: <span class="id" title="tactic">apply</span> <span class="id" title="var">Hcreator</span>; <span class="id" title="tactic">eauto</span>; [<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="lemma">All_Forall.In_Forall</span>, <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_token_acts_is_account"><span class="id" title="lemma">create_token_acts_is_account</span></a> | <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_token_acts_origin_correct"><span class="id" title="lemma">create_token_acts_origin_correct</span></a> |].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;the&nbsp;funding&nbsp;period&nbsp;is&nbsp;still&nbsp;not&nbsp;over&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <span class="id" title="var">bstate0</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a> <span class="id" title="var">cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#cb53cf0ee22c036a03b4a9281c68b5a3"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span> <span class="id" title="tactic">in</span> <span class="id" title="var">funding_period_not_over</span> <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;the&nbsp;environment&nbsp;in&nbsp;the&nbsp;new&nbsp;ChainState&nbsp;is&nbsp;correct&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#setter_from_getter_Environment_env_account_balances"><span class="id" title="definition">setter_from_getter_Environment_env_account_balances</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a> =&gt; <a class="idref" href="ConCert.Execution.Blockchain.html#add_balance"><span class="id" title="definition">add_balance</span></a> <span class="id" title="var">creator</span> <span class="id" title="var">reward</span> (<a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <span class="id" title="var">bstate</span>)) <span class="id" title="var">bstate</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">bstate0</span>.(<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_env"><span class="id" title="projection">chain_state_env</span></a>) <span class="id" title="tactic">in</span> <span class="id" title="var">queue0</span> <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue0</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_token_acts_eq"><span class="id" title="lemma">create_token_acts_eq</span></a>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">now</span> <span class="id" title="var">rewrite_environment_equiv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;there&nbsp;is&nbsp;still&nbsp;enough&nbsp;balance&nbsp;in&nbsp;accounts&nbsp;to&nbsp;hit&nbsp;funding&nbsp;goal&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">bstate</span> <span class="id" title="keyword">with</span> <span class="id" title="var">bstate0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.mul_le_mono_r"><span class="id" title="lemma">N.mul_le_mono_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.Znat.html#Z2N.inj_le"><span class="id" title="lemma">Z2N.inj_le</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_balance_positive"><span class="id" title="lemma">total_balance_positive</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_balance_le"><span class="id" title="lemma">total_balance_le</span></a> <span class="id" title="var">bstate</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">rewrite_environment_equiv</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>; <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">update_all</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">bstate0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">cstate</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Next&nbsp;we&nbsp;do&nbsp;induction&nbsp;on&nbsp;account&nbsp;to&nbsp;evaluate&nbsp;all&nbsp;the&nbsp;actions&nbsp;added&nbsp;to&nbsp;the&nbsp;queue&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">accounts</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;If&nbsp;the&nbsp;queue&nbsp;is&nbsp;empty&nbsp;then&nbsp;we&nbsp;know&nbsp;that&nbsp;the&nbsp;funding&nbsp;goal&nbsp;was&nbsp;hit<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;can&nbsp;then&nbsp;apply&nbsp;can_finalize_if_creation_min&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">accounts_unique</span> <span class="id" title="var">accounts_not_contracts</span> <span class="id" title="var">can_hit_fund_min</span> <span class="id" title="var">echange_rate_nonzero</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">finalized</span> <span class="id" title="var">funding_period_not_over</span> <span class="id" title="var">funding_period_started</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_0_r"><span class="id" title="lemma">N.le_0_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.sub_0_le"><span class="id" title="lemma">N.sub_0_le</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#can_finalize_if_creation_min"><span class="id" title="lemma">can_finalize_if_creation_min</span></a> <span class="id" title="var">bstate0</span> <span class="id" title="var">reward</span> <span class="id" title="var">caddr</span> <span class="id" title="var">creator</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> []; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#empty_queue_is_emptyable"><span class="id" title="lemma">empty_queue_is_emptyable</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">clear</span> <span class="id" title="var">reward</span> <span class="id" title="var">Hreward</span> <span class="id" title="var">creator</span> <span class="id" title="var">Hcreator</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#NoDup_cons_iff"><span class="id" title="lemma">NoDup_cons_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">accounts_unique</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">accounts_unique</span> <span class="id" title="var">accounts_unique'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="lemma">list.Forall_cons</span> <span class="id" title="tactic">in</span> <span class="id" title="var">accounts_not_contracts</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">accounts_not_contracts</span> <span class="id" title="var">accounts_not_contracts'</span>].<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Check&nbsp;if&nbsp;funding&nbsp;goal&nbsp;was&nbsp;alredy&nbsp;hit&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <span class="id" title="var">cstate</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">-</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <span class="id" title="var">cstate</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">tokens_left_to_fund</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(*&nbsp;If&nbsp;funding&nbsp;goal&nbsp;is&nbsp;reached&nbsp;then&nbsp;we&nbsp;know&nbsp;that&nbsp;create_token_acts&nbsp;will&nbsp;not<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;produce&nbsp;any&nbsp;more&nbsp;actions&nbsp;so&nbsp;the&nbsp;queue&nbsp;is&nbsp;actually&nbsp;empty.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Therefore&nbsp;we&nbsp;can&nbsp;directly&nbsp;apply&nbsp;the&nbsp;induction&nbsp;hypothesis&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHaccounts</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">tokens_left_to_fund</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">tokens_left_to_fund</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_0_l"><span class="id" title="lemma">N.le_0_l</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">tokens_left_to_fund</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;check&nbsp;if&nbsp;the&nbsp;account&nbsp;balance&nbsp;is&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (0 <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#f1746f02f141d025b1e53605943919bf"><span class="id" title="notation">&lt;?</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_account_balances"><span class="id" title="projection">env_account_balances</span></a> <span class="id" title="var">bstate0</span> <span class="id" title="var">a</span>)%<span class="id" title="var">Z</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">balance_positive</span>; <span class="id" title="var">cycle</span> 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.ltb_ge"><span class="id" title="lemma">Z.ltb_ge</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">balance_positive</span> | <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.ltb_lt"><span class="id" title="lemma">Z.ltb_lt</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">balance_positive</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="comment">(*&nbsp;If&nbsp;account&nbsp;balance&nbsp;is&nbsp;0&nbsp;then&nbsp;we&nbsp;need&nbsp;to&nbsp;discard&nbsp;the&nbsp;action&nbsp;as&nbsp;it<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cannot&nbsp;be&nbsp;evaluated&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">amount_zero</span> : (<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <a class="idref" href="ConCert.Execution.Examples.BAT.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#306329b0eca7a2b86c198702f594ad8e"><span class="id" title="notation">&lt;=</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.to_N"><span class="id" title="definition">Z.to_N</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 0%<span class="id" title="var">N</span>)%<span class="id" title="var">Z</span>) <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_token_acts_cons"><span class="id" title="lemma">create_token_acts_cons</span></a>, <span class="id" title="var">amount_zero</span>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.min_0_r"><span class="id" title="lemma">N.min_0_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.mul_0_l"><span class="id" title="lemma">N.mul_0_l</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.sub_0_r"><span class="id" title="lemma">N.sub_0_r</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">queue0</span> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">discard_invalid_action</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;the&nbsp;action&nbsp;cannot&nbsp;be&nbsp;evaluated&nbsp;since&nbsp;create_tokens<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;requires&nbsp;to&nbsp;be&nbsp;called&nbsp;with&nbsp;amount&nbsp;&gt;&nbsp;0&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">accounts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">cstate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">p</span> <span class="id" title="var">reach0</span> <span class="id" title="var">accounts_not_contracts</span> <span class="id" title="var">balance_positive</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="tactic">eval</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_action_eval</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">act_eq</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">contract_deployed</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deployed</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">deployed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#wc_receive_strong"><span class="id" title="lemma">wc_receive_strong</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span> <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">prev_state'</span> &amp; <span class="id" title="var">msg'</span> &amp; <span class="id" title="var">new_state'</span> &amp; <span class="id" title="var">serialize_prev_state</span> &amp; <span class="id" title="var">serialize_msg</span> &amp; <span class="id" title="var">serialize_new_state</span> &amp; <span class="id" title="var">receive_some</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="tactic">in</span> <span class="id" title="var">serialize_msg</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">congruence</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">serialize_msg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <a class="idref" href="ConCert.Execution.Serializable.html#deserialize_serialize"><span class="id" title="method">deserialize_serialize</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">serialize_msg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">serialize_msg</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_create_tokens_amount_correct"><span class="id" title="lemma">try_create_tokens_amount_correct</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <span class="comment">(*&nbsp;Apply&nbsp;induction&nbsp;hypothesis&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">edestruct</span> <span class="id" title="var">IHaccounts</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">bstate0</span> := <span class="id" title="var">bstate</span>) (<span class="id" title="var">cstate</span> := <span class="id" title="var">cstate</span>) <span class="id" title="keyword">as</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">bstate_new</span> &amp; <span class="id" title="var">reach_new</span> &amp; <span class="id" title="var">emptyable_new</span> &amp; <span class="id" title="var">H</span>); <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">try</span> (<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_token_acts_eq"><span class="id" title="lemma">create_token_acts_eq</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">now</span> <span class="id" title="var">rewrite_environment_equiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_balance_distr"><span class="id" title="lemma">total_balance_distr</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.add_comm"><span class="id" title="lemma">N.add_comm</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_balance_eq"><span class="id" title="lemma">total_balance_eq</span></a> <span class="id" title="var">_</span> <span class="id" title="var">bstate0</span>) <span class="id" title="tactic">by</span> (<span class="id" title="tactic">intros</span>; <span class="id" title="var">now</span> <span class="id" title="var">rewrite_environment_equiv</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Now&nbsp;we&nbsp;know&nbsp;that&nbsp;the&nbsp;action&nbsp;is&nbsp;valid&nbsp;we&nbsp;need&nbsp;to&nbsp;evaluate&nbsp;it&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">evaluate_action</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only</span> 1-4: <span class="id" title="tactic">clear</span> <span class="id" title="var">fund_deposit_not_contract</span> <span class="id" title="var">accounts_not_contracts</span> <span class="id" title="var">IHaccounts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;there&nbsp;is&nbsp;an&nbsp;action&nbsp;in&nbsp;the&nbsp;queue&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_token_acts_cons"><span class="id" title="lemma">create_token_acts_cons</span></a> <span class="id" title="tactic">by</span> <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;amount&nbsp;is&nbsp;nonnegative&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.le_ge"><span class="id" title="lemma">Z.le_ge</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.Znat.html#N2Z.is_nonneg"><span class="id" title="lemma">N2Z.is_nonneg</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;amount&nbsp;&lt;=&nbsp;account&nbsp;balance&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;receive&nbsp;returns&nbsp;Some&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">accounts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">contract_deployed</span> <span class="id" title="var">contract_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb_ge"><span class="id" title="lemma">Nat.ltb_ge</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">funding_period_started</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Arith.PeanoNat.html#Nat.ltb_ge"><span class="id" title="lemma">Nat.ltb_ge</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">funding_period_not_over</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">finalized</span>, <span class="id" title="var">funding_period_started</span>, <span class="id" title="var">funding_period_not_over</span>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.Znat.html#N2Z.inj_min"><span class="id" title="lemma">N2Z.inj_min</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.Znat.html#Z2N.id"><span class="id" title="lemma">Z2N.id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.ge_le"><span class="id" title="lemma">Z.ge_le</span></a>, <a class="idref" href="ConCert.Execution.Blockchain.html#account_balance_nonnegative"><span class="id" title="lemma">account_balance_nonnegative</span></a>; <span class="id" title="tactic">eauto</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">finalized</span> <span class="id" title="var">funding_period_started</span> <span class="id" title="var">funding_period_not_over</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">match_amount</span>; <span class="id" title="var">destruct_throw_if</span> <span class="id" title="var">match_amount</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_match</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">match_cap</span>; <span class="id" title="var">destruct_throw_if</span> <span class="id" title="var">match_cap</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="comment">(*&nbsp;Prove&nbsp;contradiction&nbsp;between&nbsp;match_amount,&nbsp;match_cap&nbsp;and&nbsp;can_hit_fund_min&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.ltb_lt"><span class="id" title="lemma">N.ltb_lt</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">match_cap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.leb_gt"><span class="id" title="lemma">Z.leb_gt</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.min_glb_lt_iff"><span class="id" title="lemma">Z.min_glb_lt_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">match_amount</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">min_left</span> <span class="id" title="var">min_right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.Znat.html#Z2N.inj_min"><span class="id" title="lemma">Z2N.inj_min</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.Znat.html#N2Z.id"><span class="id" title="lemma">N2Z.id</span></a>, &lt;- <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.mul_min_distr_r"><span class="id" title="lemma">N.mul_min_distr_r</span></a>, &lt;- <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.add_min_distr_l"><span class="id" title="lemma">N.add_min_distr_l</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.min_glb_lt_iff"><span class="id" title="lemma">N.min_glb_lt_iff</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">match_cap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">match_cap</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">match_cap_left</span> <span class="id" title="var">match_cap_right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.lt_le_trans"><span class="id" title="lemma">N.lt_le_trans</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">p</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <span class="id" title="var">cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#64708cc1fcff61c206ed571fe7828ea8"><span class="id" title="notation">+</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenExchangeRate"><span class="id" title="projection">tokenExchangeRate</span></a> <span class="id" title="var">cstate</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">match_cap_left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.mul_add_distr_r"><span class="id" title="lemma">N.mul_add_distr_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.mul_1_l"><span class="id" title="lemma">N.mul_1_l</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.add_assoc"><span class="id" title="lemma">N.add_assoc</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.add_comm"><span class="id" title="lemma">N.add_comm</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.add_assoc"><span class="id" title="lemma">N.add_assoc</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.add_le_mono_r"><span class="id" title="lemma">N.add_le_mono_r</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#N_le_sub"><span class="id" title="lemma">N_le_sub</span></a>. <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#N_div_mul_le"><span class="id" title="lemma">N_div_mul_le</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="comment">(*&nbsp;Prove&nbsp;contradiction&nbsp;between&nbsp;match_amount,&nbsp;balance_positive&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.Zbool.html#Zle_bool_imp_le"><span class="id" title="lemma">Zle_bool_imp_le</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.min_le"><span class="id" title="lemma">Z.min_le</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">match_amount</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">min_left</span> | <span class="id" title="var">min_right</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.Znat.html#N2Z.inj_0"><span class="id" title="lemma">N2Z.inj_0</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">min_left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.Znat.html#N2Z.inj_le"><span class="id" title="lemma">N2Z.inj_le</span></a>, <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#N_le_add_distr"><span class="id" title="lemma">N_le_add_distr</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">min_left</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">assert</span> (<span class="id" title="var">caddr_not_in_accounts</span> : <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">~</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#In"><span class="id" title="definition">In</span></a> <span class="id" title="var">caddr</span> <span class="id" title="var">accounts</span>) <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">intro</span>; <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#Forall_forall"><span class="id" title="lemma">Forall_forall</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">accounts_not_contracts'</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">accounts_not_contracts'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#contract_addr_format"><span class="id" title="lemma">contract_addr_format</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">contract_deployed</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;Apply&nbsp;induction&nbsp;hypothesis&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">edestruct</span> <span class="id" title="var">IHaccounts</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">bstate_new</span> &amp; <span class="id" title="var">reach_new</span> &amp; <span class="id" title="var">emptyable_new</span> &amp; <span class="id" title="var">H</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">IHaccounts</span> <span class="id" title="var">accounts_not_contracts</span> <span class="id" title="var">balance_positive</span> <span class="id" title="var">queue0</span> <span class="id" title="var">tokens_left_to_fund</span> <span class="id" title="var">p</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">only</span> 12: (<span class="id" title="tactic">rewrite</span> <span class="id" title="var">deployed_state</span>; <span class="id" title="tactic">eauto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> (<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="tactic">eauto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.Znat.html#Z2N.inj_min"><span class="id" title="lemma">Z2N.inj_min</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.Znat.html#N2Z.id"><span class="id" title="lemma">N2Z.id</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">deployed_state</span> <span class="id" title="var">contract_deployed</span> <span class="id" title="var">funding_period_started</span> <span class="id" title="var">funding_period_not_over</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">can_hit_fund_min</span> <span class="id" title="var">fund_deposit_not_contract</span> <span class="id" title="var">finalized</span> <span class="id" title="var">contract_state</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;the&nbsp;queues&nbsp;of&nbsp;the&nbsp;two&nbsp;ChainStates&nbsp;are&nbsp;equivalent&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.sub_add_distr"><span class="id" title="lemma">N.sub_add_distr</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#create_token_acts_eq"><span class="id" title="lemma">create_token_acts_eq</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">rewrite_environment_equiv</span>. <span class="id" title="var">cbn</span>. <span class="id" title="var">now</span> <span class="id" title="var">destruct_address_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="comment">(*&nbsp;Prove&nbsp;that&nbsp;there&nbsp;still&nbsp;is&nbsp;enough&nbsp;balance&nbsp;to&nbsp;hit&nbsp;funding&nbsp;goal&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">queue</span> <span class="id" title="var">accounts_not_contracts'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">edestruct</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.min_dec"><span class="id" title="lemma">N.min_dec</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="var">cbn</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; [| <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_0_l"><span class="id" title="lemma">N.le_0_l</span></a>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.mul_add_distr_r"><span class="id" title="lemma">N.mul_add_distr_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.mul_1_l"><span class="id" title="lemma">N.mul_1_l</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_0_r"><span class="id" title="lemma">N.le_0_r</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.sub_add_distr"><span class="id" title="lemma">N.sub_add_distr</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.sub_add_distr"><span class="id" title="lemma">N.sub_add_distr</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.sub_0_le"><span class="id" title="lemma">N.sub_0_le</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#N_le_div_mul"><span class="id" title="lemma">N_le_div_mul</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="tactic">rewrite</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_balance_distr"><span class="id" title="lemma">total_balance_distr</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.add_comm"><span class="id" title="lemma">N.add_comm</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_balance_eq"><span class="id" title="lemma">total_balance_eq</span></a> <span class="id" title="var">_</span> <span class="id" title="var">bstate0</span>) <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">intros</span>; <span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">now</span> <span class="id" title="var">destruct_address_eq</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_sub_le_add_r"><span class="id" title="lemma">N.le_sub_le_add_r</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.sub_add_distr"><span class="id" title="lemma">N.sub_add_distr</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; [| <span class="id" title="tactic">apply</span> <span class="id" title="var">enough_balance_to_fund</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.sub_le_mono_l"><span class="id" title="lemma">N.sub_le_mono_l</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.add_le_mono_l"><span class="id" title="lemma">N.add_le_mono_l</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.mul_le_mono_r"><span class="id" title="lemma">N.mul_le_mono_r</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lia</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="can_deploy_and_finalize"><span class="id" title="lemma">can_deploy_and_finalize</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">bstate</span> (<span class="id" title="var">reward</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Amount"><span class="id" title="definition">Amount</span></a>) (<span class="id" title="var">caddr</span> <span class="id" title="var">creator</span> : <a class="idref" href="ConCert.Execution.Blockchain.html#Address"><span class="id" title="method">Address</span></a>) <span class="id" title="var">accounts</span> <span class="id" title="var">setup</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#creator"><span class="id" title="variable">creator</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Examples.BAT.html#reward"><span class="id" title="variable">reward</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#b1f0780291abe9bd18804d2c9a5039d4"><span class="id" title="notation">&gt;=</span></a> 0)%<span class="id" title="var">Z</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ae9a5e1034e143b218b09d8e454472bd"><span class="id" title="notation">[]</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#NoDup"><span class="id" title="inductive">NoDup</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#accounts"><span class="id" title="variable">accounts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#Forall"><span class="id" title="inductive">Forall</span></a> (<span class="id" title="keyword">fun</span> <span class="id" title="var">acc</span> =&gt; <a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#acc"><span class="id" title="variable">acc</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a>) <a class="idref" href="ConCert.Execution.Examples.BAT.html#accounts"><span class="id" title="variable">accounts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">((</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_tokenCreationMin"><span class="id" title="projection">_tokenCreationMin</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">-</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_batFund"><span class="id" title="projection">_batFund</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">))</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.to_N"><span class="id" title="definition">Z.to_N</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#spendable_balance"><span class="id" title="definition">spendable_balance</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#accounts"><span class="id" title="variable">accounts</span></a>)<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">*</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_tokenExchangeRate"><span class="id" title="projection">_tokenExchangeRate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#fe1417cc32a1703619b26940ce957c6a"><span class="id" title="notation">)</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_tokenExchangeRate"><span class="id" title="projection">_tokenExchangeRate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#2ccca3280733654024e33c2005ae2530"><span class="id" title="notation">&lt;=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_tokenCreationCap"><span class="id" title="projection">_tokenCreationCap</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#81673c7f7694c33c829aabf88ab05436"><span class="id" title="notation">-</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_tokenCreationMin"><span class="id" title="projection">_tokenCreationMin</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_fundingStart"><span class="id" title="projection">_fundingStart</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_fundingEnd"><span class="id" title="projection">_fundingEnd</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;(<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#env_chain"><span class="id" title="projection">env_chain</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_fundingStart"><span class="id" title="projection">_fundingStart</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">)</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#address_is_contract"><span class="id" title="method">address_is_contract</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_fundDeposit"><span class="id" title="projection">_fundDeposit</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#false"><span class="id" title="constructor">false</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#setup"><span class="id" title="variable">setup</span></a>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_tokenExchangeRate"><span class="id" title="projection">_tokenExchangeRate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> 0 <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">bstate'</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.BuildUtils.html#reachable_through"><span class="id" title="definition">reachable_through</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate'"><span class="id" title="variable">bstate'</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.BuildUtils.html#emptyable"><span class="id" title="definition">emptyable</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate'"><span class="id" title="variable">bstate'</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">cstate</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate'"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate'"><span class="id" title="variable">bstate'</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#serializeState"><span class="id" title="definition">serializeState</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#isFinalized"><span class="id" title="projection">isFinalized</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#true"><span class="id" title="constructor">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">Hcreator</span> <span class="id" title="var">Hreward</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">bstate_reachable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">bstate_queue</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">accounts_unique</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">accounts_not_contracts</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">caddr_is_contract</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_not_deployed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">enough_balance_to_fund</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">can_hit_fund_min</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">funding_period_nonempty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">funding_period_not_started</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fund_deposit_not_contract</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">echange_rate_nonzero</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">add_block</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">[(</span></a><a class="idref" href="ConCert.Execution.Examples.BATCommon.html#deploy_act"><span class="id" title="definition">deploy_act</span></a> <span class="id" title="var">setup</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a> <span class="id" title="var">creator</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Lists.List.html#ddd65c2f7ee73ecec433744948d846bb"><span class="id" title="notation">)]</span></a> 1%<span class="id" title="var">nat</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="lemma">list.Forall_singleton</span>, <a class="idref" href="ConCert.Execution.Blockchain.html#address_eq_refl"><span class="id" title="lemma">address_eq_refl</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="var">update</span> (<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">(</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <span class="id" title="var">bstate0</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#_fundingStart"><span class="id" title="projection">_fundingStart</span></a> <span class="id" title="var">setup</span>)%<span class="id" title="var">nat</span> <span class="id" title="tactic">in</span> <span class="id" title="var">funding_period_not_started</span> <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">bstate</span> <span class="id" title="keyword">with</span> <span class="id" title="var">bstate0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span> <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">enough_balance_to_fund</span> | <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.mul_le_mono_r"><span class="id" title="lemma">N.mul_le_mono_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.Znat.html#Z2N.inj_le"><span class="id" title="lemma">Z2N.inj_le</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#spendable_balance_positive"><span class="id" title="lemma">spendable_balance_positive</span></a>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#spendable_balance"><span class="id" title="definition">spendable_balance</span></a>, <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#pending_usage"><span class="id" title="definition">pending_usage</span></a>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>, <span class="id" title="var">bstate_queue</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Extras.html#sumZ_le"><span class="id" title="lemma">sumZ_le</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">update_all</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">deploy_contract</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#account_balance_nonnegative"><span class="id" title="lemma">account_balance_nonnegative</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#constants_are_constant"><span class="id" title="lemma">constants_are_constant</span></a> <span class="id" title="keyword">as</span> (<span class="id" title="var">dep_info</span> &amp; <span class="id" title="var">cstate'</span> &amp; <span class="id" title="var">deploy_info'</span> &amp; <span class="id" title="var">deployed_state'</span> &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ? &amp; ?); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Blockchain.html#contract_state"><span class="id" title="definition">contract_state</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed_state'</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">deployed_state</span>, <a class="idref" href="ConCert.Execution.Serializable.html#deserialize_serialize"><span class="id" title="method">deserialize_serialize</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deployed_state'</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">cstate'</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">deploy_info</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deploy_info'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deploy_info'</span>. <span class="id" title="tactic">subst</span> <span class="id" title="var">dep_info</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">deploy_info'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">H</span> : <span class="id" title="var">_</span> <span class="id" title="var">cstate</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a>  <span class="id" title="var">_</span> <span class="id" title="var">setup</span> |- <span class="id" title="var">_</span>=&gt; <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">update</span> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#initSupply"><span class="id" title="projection">initSupply</span></a> <span class="id" title="var">cstate</span>) <span class="id" title="keyword">with</span> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <span class="id" title="var">cstate</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span> <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; [<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.sub_le_mono_l"><span class="id" title="lemma">N.sub_le_mono_l</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.eq_le_incl"><span class="id" title="lemma">N.eq_le_incl</span></a> | <span class="id" title="tactic">apply</span> <span class="id" title="var">enough_balance_to_fund</span>]; <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Heqcstate</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">bstate0</span> <span class="id" title="keyword">with</span> <span class="id" title="var">bstate</span> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span> <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">enough_balance_to_fund</span> | <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.mul_le_mono_r"><span class="id" title="lemma">N.mul_le_mono_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.Znat.html#Z2N.inj_le"><span class="id" title="lemma">Z2N.inj_le</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#spendable_balance_positive"><span class="id" title="lemma">spendable_balance_positive</span></a>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#spendable_consume_act"><span class="id" title="lemma">spendable_consume_act</span></a>; <span class="id" title="tactic">eauto</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">trace</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">update_all</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="var">forward_time_exact</span> (<span class="id" title="var">cstate</span>.(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingStart"><span class="id" title="projection">fundingStart</span></a>)); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">bstate</span> <span class="id" title="keyword">with</span> <span class="id" title="var">bstate0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">enough_balance_to_fund</span> <span class="id" title="tactic">by</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">inversion</span> <span class="id" title="var">header_valid</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.le_trans"><span class="id" title="lemma">N.le_trans</span></a>; [<span class="id" title="tactic">apply</span> <span class="id" title="var">enough_balance_to_fund</span> | <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#N.mul_le_mono_r"><span class="id" title="lemma">N.mul_le_mono_r</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.Znat.html#Z2N.inj_le"><span class="id" title="lemma">Z2N.inj_le</span></a>; <span class="id" title="tactic">try</span> <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#spendable_balance_positive"><span class="id" title="lemma">spendable_balance_positive</span></a>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#spendable_balance"><span class="id" title="definition">spendable_balance</span></a>, <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#pending_usage"><span class="id" title="definition">pending_usage</span></a>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>, <span class="id" title="var">queue0</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.Extras.html#sumZ_le"><span class="id" title="lemma">sumZ_le</span></a>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">rewrite_environment_equiv</span>; <span class="id" title="var">cbn</span>; <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">lia</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">funding_period_not_started</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">update_all</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#can_finalize_if_deployed"><span class="id" title="lemma">can_finalize_if_deployed</span></a>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">queue</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#empty_queue_is_emptyable"><span class="id" title="lemma">empty_queue_is_emptyable</span></a>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intuition</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab152"></a><h2 class="section">Refund guarantee</h2>

<div class="paragraph"> </div>

 The BAToken contract should guarantee that all tokens (except for the free initSupply given to batFundDeposit)
    can be fully refunded. However as shown in the property based tests this is not the case so we can only prove
    a weaker result stating that refund msgs can always be consumed. This does not guarantee refunding as the
    proof does not state that the new actions produced by refund entrypoint can be evaluated. Thus it is not
    guaranteed that the state changes will be applied 
</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <a name="weak_refund_guarantee"><span class="id" title="lemma">weak_refund_guarantee</span></a> : <span class="id" title="keyword">forall</span> <span class="id" title="var">bstate</span> <span class="id" title="var">cstate</span> <span class="id" title="var">caddr</span> <span class="id" title="var">account</span> <span class="id" title="var">acts</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">refund_act</span> := <a class="idref" href="ConCert.Execution.Blockchain.html#build_act"><span class="id" title="constructor">build_act</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#act_call"><span class="id" title="constructor">act_call</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> 0 <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#refund"><span class="id" title="constructor">refund</span></a>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#reachable"><span class="id" title="definition">reachable</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contracts"><span class="id" title="projection">env_contracts</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Examples.BAT.html#contract"><span class="id" title="definition">BAT.contract</span></a> : <a class="idref" href="ConCert.Execution.Blockchain.html#WeakContract"><span class="id" title="inductive">WeakContract</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#env_contract_states"><span class="id" title="projection">env_contract_states</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#caddr"><span class="id" title="variable">caddr</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> (<a class="idref" href="ConCert.Execution.Serializable.html#serialize"><span class="id" title="method">serialize</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#refund_act"><span class="id" title="variable">refund_act</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#cbcf67aac0c2a85b8d93d37de9969adf"><span class="id" title="notation">::</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#acts"><span class="id" title="variable">acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a><br/>
&nbsp;&nbsp;(<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#fundingEnd"><span class="id" title="projection">fundingEnd</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Peano.html#00fe0eaf5e6949f0a31725357afa4bba"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#current_slot"><span class="id" title="projection">current_slot</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a>)%<span class="id" title="var">nat</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;funding&nbsp;period&nbsp;is&nbsp;over&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#total_supply"><span class="id" title="definition">total_supply</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#f0f4688c5a02589da6dbdaffc379b3bb"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#tokenCreationMin"><span class="id" title="projection">tokenCreationMin</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;funding&nbsp;failed&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a0a5068f83a704fcfbda8cd473a6cfea"><span class="id" title="notation">&lt;&gt;</span></a> <a class="idref" href="ConCert.Execution.Examples.BATCommon.html#batFundDeposit"><span class="id" title="projection">batFundDeposit</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;sender&nbsp;is&nbsp;not&nbsp;batFundDeposit&nbsp;*)</span><br/>
&nbsp;&nbsp;0 <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.NArith.BinNat.html#f0f4688c5a02589da6dbdaffc379b3bb"><span class="id" title="notation">&lt;</span></a> <a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#account"><span class="id" title="variable">account</span></a> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#cstate"><span class="id" title="variable">cstate</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#1c93e43e07fbeaeb6a625cb6614beb5d"><span class="id" title="notation">-&gt;</span></a> <span class="comment">(*&nbsp;account&nbsp;owns&nbsp;some&nbsp;tokens&nbsp;*)</span><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">exists</span></a> <span class="id" title="var">new_bstate</span> <span class="id" title="var">new_acts</span><a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#chain_state_queue"><span class="id" title="projection">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_bstate"><span class="id" title="variable">new_bstate</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#bc347c51eaf667706ae54503b26d52c6"><span class="id" title="notation">++</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#acts"><span class="id" title="variable">acts</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">/\</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Logic.html#inhabited"><span class="id" title="inductive">inhabited</span></a> (<a class="idref" href="ConCert.Execution.Blockchain.html#ActionEvaluation"><span class="id" title="inductive">ActionEvaluation</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#bstate"><span class="id" title="variable">bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#refund_act"><span class="id" title="variable">refund_act</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_bstate"><span class="id" title="variable">new_bstate</span></a> <a class="idref" href="ConCert.Execution.Examples.BAT.html#new_acts"><span class="id" title="variable">new_acts</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> * <span class="id" title="var">reach</span> <span class="id" title="var">deployed</span> <span class="id" title="var">deployed_state</span> <span class="id" title="var">queue</span> <span class="id" title="var">funding_over</span> <span class="id" title="var">funding_failed</span> <span class="id" title="var">account_not_batfund</span> <span class="id" title="var">has_tokens</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">refund_act</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#no_finalization_before_goal"><span class="id" title="lemma">no_finalization_before_goal</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">reach</span> <span class="id" title="keyword">as</span> <span class="id" title="var">not_finalized</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">not_finalized</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">cstate'</span> &amp; <span class="id" title="var">deployed_state'</span> &amp; <span class="id" title="var">not_finalized</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">deployed_state</span>, <a class="idref" href="ConCert.Execution.Serializable.html#deserialize_serialize"><span class="id" title="method">deserialize_serialize</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span> <span class="id" title="var">cstate'</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eexists</span> {| <a class="idref" href="ConCert.Execution.Blockchain.html#build_chain_state"><span class="id" title="constructor">chain_state_env</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#build_chain_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#build_chain_state"><span class="id" title="constructor">_</span></a><a class="idref" href="ConCert.Execution.Blockchain.html#build_chain_state"><span class="id" title="constructor">;</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#build_chain_state"><span class="id" title="constructor">chain_state_queue</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#build_chain_state"><span class="id" title="constructor">:=</span></a> <a class="idref" href="ConCert.Execution.Blockchain.html#build_chain_state"><span class="id" title="constructor">_</span></a> |}.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eexists</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="var">cycle</span> 1.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="ConCert.Execution.Blockchain.html#eval_call"><span class="id" title="constructor">eval_call</span></a> <span class="id" title="keyword">with</span> (<span class="id" title="var">msg</span> := <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">_</span>); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">lia</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.11.2/stdlib//Coq.ZArith.BinInt.html#Z.ge_le"><span class="id" title="lemma">Z.ge_le</span></a>, <a class="idref" href="ConCert.Execution.Blockchain.html#account_balance_nonnegative"><span class="id" title="lemma">account_balance_nonnegative</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">specialize</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#try_refund_is_some"><span class="id" title="lemma">try_refund_is_some</span></a> <span class="id" title="keyword">as</span> [[<span class="id" title="var">new_cstate</span> [<span class="id" title="var">resp_acts</span> <span class="id" title="var">receive_some</span>]] <span class="id" title="var">_</span>]; <span class="id" title="var">cycle</span> 1.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <a class="idref" href="ConCert.Execution.BuildUtils.html#wc_receive_to_receive"><span class="id" title="lemma">wc_receive_to_receive</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">H1</span> <span class="id" title="var">into</span> <span class="id" title="var">account_balance_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span> (<a class="idref" href="ConCert.Execution.Extras.html#with_default"><span class="id" title="definition">with_default</span></a> 0 (<a class="idref" href="ConCert.Execution.Containers.html#FMap.find"><span class="id" title="abbreviation">FMap.find</span></a> <span class="id" title="var">account</span> (<a class="idref" href="ConCert.Execution.Examples.BATCommon.html#balances"><span class="id" title="definition">balances</span></a> <span class="id" title="var">cstate</span>))); <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">account_balance_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">repeat</span> <span class="id" title="tactic">split</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">now</span> <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">eauto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#BAT.Theories"><span class="id" title="section">Theories</span></a>.<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="ConCert.Execution.Examples.BAT.html#BAT"><span class="id" title="section">BAT</span></a>.<br/>
</div>
</div>
<div id="footer">
  Generated by <a href="http://coq.inria.fr/">coqdoc</a> and improved with <a href="https://github.com/tebbi/coqdocjs">CoqdocJS</a> and <a href="https://github.com/jgallen23/toc">TOC</a>
</div>
</div>
<script>
  const elements = document.getElementsByClassName("libtitle");
  while(elements.length > 0){
        elements[0].parentNode.removeChild(elements[0]);
  }
  if (window.location.pathname.endsWith("/toc.html")) {
      const jstocDiv = document.getElementById("js-toc");
      jstocDiv.classList.remove("toc");
      jstocDiv.classList.add("jstoc-hidden");
      const jstocHeaderDiv = document.getElementById("js-toc-header");
      jstocHeaderDiv.classList.add("jstoc-hidden");
  }
  console.log(window.location.pathname);
</script>
<script type="text/javascript" src="toc.js"></script>
</body>

</html>
